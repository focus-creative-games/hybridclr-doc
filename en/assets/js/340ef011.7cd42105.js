"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9159],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>y});var i=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var o=i.createContext({}),d=function(e){var t=i.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=d(e.components);return i.createElement(o.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},p=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,o=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=d(n),p=a,y=c["".concat(o,".").concat(p)]||c[p]||m[p]||r;return n?i.createElement(y,s(s({ref:t},u),{},{components:n})):i.createElement(y,s({ref:t},u))}));function y(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,s=new Array(r);s[0]=p;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l[c]="string"==typeof e?e:a,s[1]=l;for(var d=2;d<r;d++)s[d]=n[d];return i.createElement.apply(null,s)}return i.createElement.apply(null,n)}p.displayName="MDXCreateElement"},39614:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>m,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var i=n(87462),a=(n(67294),n(3905));const r={},s="Using in Code",l={unversionedId:"business/ultimate/useIncodes",id:"version-8.5.0/business/ultimate/useIncodes",title:"Using in Code",description:"RuntimeApi::LoadOriginalDifferentialHybridAssembly",source:"@site/i18n/en/docusaurus-plugin-content-docs/version-8.5.0/business/ultimate/useIncodes.md",sourceDirName:"business/ultimate",slug:"/business/ultimate/useIncodes",permalink:"/en/docs/8.5.0/business/ultimate/useIncodes",draft:!1,tags:[],version:"8.5.0",frontMatter:{}},o={},d=[{value:"RuntimeApi::LoadOriginalDifferentialHybridAssembly",id:"runtimeapiloadoriginaldifferentialhybridassembly",level:2},{value:"RuntimeApi::LoadDifferentialHybridAssemblyUnchecked",id:"runtimeapiloaddifferentialhybridassemblyunchecked",level:2},{value:"Notes",id:"notes",level:2}],u={toc:d},c="wrapper";function m(e){let{components:t,...n}=e;return(0,a.kt)(c,(0,i.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"using-in-code"},"Using in Code"),(0,a.kt)("h2",{id:"runtimeapiloadoriginaldifferentialhybridassembly"},"RuntimeApi::LoadOriginalDifferentialHybridAssembly"),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Supported since v6.6.0.")),(0,a.kt)("p",null,"When building the app for the first time without any code updates, or when there are code updates but the code in this DHE assembly hasn't changed, you can call this interface to indicate that the original AOT implementation should be used completely."),(0,a.kt)("p",null,"Example code:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'    string assFile = $"{Application.streamingAssetsPath}/{assName}.dll.bytes";\n    // If it doesn\'t exist, use the original AOT assembly\n    if (!File.Exists(assFile))\n    {\n        LoadImageErrorCode err = RuntimeApi.LoadOriginalDifferentialHybridAssembly(assName);\n        if (err == LoadImageErrorCode.OK)\n        {\n            Debug.Log($"LoadOriginalDifferentialHybridAssembly {assName} OK");\n        }\n        else\n        {\n            Debug.LogError($"LoadOriginalDifferentialHybridAssembly {assName} failed, err={err}");\n        }\n    }\n')),(0,a.kt)("h2",{id:"runtimeapiloaddifferentialhybridassemblyunchecked"},"RuntimeApi::LoadDifferentialHybridAssemblyUnchecked"),(0,a.kt)("p",null,"When the code of a DHE assembly changes, you need to use this interface to load the DHE assembly. Note that you cannot use Assembly.Load to load DHE assemblies, as it will cause errors."),(0,a.kt)("p",null,"This interface has two parameters: currentDllBytes and optionBytes."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"currentDllBytes is the byte array of the latest DHE assembly file"),(0,a.kt)("li",{parentName:"ul"},"optionBytes is the byte array of the dhao file. The ",(0,a.kt)("a",{parentName:"li",href:"./dhao"},"dhao file")," contains the change information for DHE, used to indicate which functions run in AOT mode and which execute interpretively.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'\n        string assFile = $"{Application.streamingAssetsPath}/{assName}.dll.bytes";\n        // If it doesn\'t exist, use the original AOT assembly\n        if (File.Exists(assFile))\n        {\n            byte[] dllBytes = File.ReadAllBytes($"{Application.streamingAssetsPath}/{assName}.dll.bytes");\n            byte[] dhaoBytes = File.ReadAllBytes($"{Application.streamingAssetsPath}/{assName}.dhao.bytes");\n            LoadImageErrorCode err = RuntimeApi.LoadDifferentialHybridAssemblyUnchecked(dllBytes, dhaoBytes);\n            if (err == LoadImageErrorCode.OK)\n            {\n                Debug.Log($"LoadDifferentialHybridAssembly {assName} OK");\n            }\n            else\n            {\n                Debug.LogError($"LoadDifferentialHybridAssembly {assName} failed, err={err}");\n            }\n        }\n\n')),(0,a.kt)("h2",{id:"notes"},"Notes"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Even if the DHE assembly hasn't changed, you still need to explicitly execute RuntimeApi::LoadOriginalDifferentialHybridAssembly before running any code in the DHE assembly"),(0,a.kt)("li",{parentName:"ul"},"You must load DHE assemblies using LoadOriginalDifferentialHybridAssembly or LoadDifferentialHybridAssemblyUnchecked in the order of assembly dependencies"),(0,a.kt)("li",{parentName:"ul"},"DHE assemblies loaded by RuntimeApi::LoadOriginalDifferentialHybridAssembly are ordinary AOT assemblies. If other hot update assemblies reference generics in this DHE assembly and full generic sharing is not enabled, the same AOT generic issues as ordinary AOT assemblies will occur, which can be resolved using full generic sharing or supplemental metadata mechanisms"),(0,a.kt)("li",{parentName:"ul"},"DHE assemblies loaded by RuntimeApi::LoadDifferentialHybridAssemblyUnchecked already contain metadata. Even when full generic sharing is not enabled, ",(0,a.kt)("strong",{parentName:"li"},"do not supplement metadata for DHE assemblies")," - supplementing will fail. Other non-DHE AOT assemblies can supplement metadata as usual.")))}m.isMDXComponent=!0}}]);