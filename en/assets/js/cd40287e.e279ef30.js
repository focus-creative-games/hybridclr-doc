"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3665],{3905:(t,e,n)=>{n.d(e,{Zo:()=>p,kt:()=>y});var a=n(67294);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(t,e){if(null==t)return{};var n,a,r=function(t,e){if(null==t)return{};var n,a,r={},i=Object.keys(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var d=a.createContext({}),c=function(t){var e=a.useContext(d),n=e;return t&&(n="function"==typeof t?t(e):l(l({},e),t)),n},p=function(t){var e=c(t.components);return a.createElement(d.Provider,{value:e},t.children)},s="mdxType",u={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},m=a.forwardRef((function(t,e){var n=t.components,r=t.mdxType,i=t.originalType,d=t.parentName,p=o(t,["components","mdxType","originalType","parentName"]),s=c(n),m=r,y=s["".concat(d,".").concat(m)]||s[m]||u[m]||i;return n?a.createElement(y,l(l({ref:e},p),{},{components:n})):a.createElement(y,l({ref:e},p))}));function y(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var i=n.length,l=new Array(i);l[0]=m;var o={};for(var d in e)hasOwnProperty.call(e,d)&&(o[d]=e[d]);o.originalType=t,o[s]="string"==typeof t?t:r,l[1]=o;for(var c=2;c<i;c++)l[c]=n[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},45560:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var a=n(87462),r=(n(67294),n(3905));const i={},l="Code Hardening",o={unversionedId:"business/basicencryption",id:"business/basicencryption",title:"Code Hardening",description:"The community version directly loads original dlls, forcing developers to carry and download original dlls. These original dlls can be decompiled by tools like ILSpy,",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/business/basicencryption.md",sourceDirName:"business",slug:"/business/basicencryption",permalink:"/en/docs/business/basicencryption",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Offline Instruction Optimization",permalink:"/en/docs/business/advancedoptimization"},next:{title:"Access Control Policy",permalink:"/en/docs/business/accesspolicy"}},d={},c=[{value:"global-metadata.dat Encryption",id:"global-metadatadat-encryption",level:2},{value:"Metadata Obfuscation",id:"metadata-obfuscation",level:2},{value:"Metadata Encryption",id:"metadata-encryption",level:2},{value:"Custom DLL File Structure",id:"custom-dll-file-structure",level:3},{value:"~string Stream Encryption",id:"string-stream-encryption",level:3},{value:"~blob stream encryption",id:"blob-stream-encryption",level:3},{value:"~US stream encryption",id:"us-stream-encryption",level:3},{value:"~table stream encryption",id:"table-stream-encryption",level:3},{value:"method body data encryption",id:"method-body-data-encryption",level:3},{value:"Structural Virtualization Technology",id:"structural-virtualization-technology",level:2},{value:"Encryption Virtualization Technology",id:"encryption-virtualization-technology",level:2},{value:"Delayed Decryption Technology",id:"delayed-decryption-technology",level:2},{value:"Instruction Virtualization Technology",id:"instruction-virtualization-technology",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Encrypt hot update dll",id:"encrypt-hot-update-dll",level:2},{value:"Runtime loading of hot update dll",id:"runtime-loading-of-hot-update-dll",level:2}],p={toc:c},s="wrapper";function u(t){let{components:e,...n}=t;return(0,r.kt)(s,(0,a.Z)({},p,n,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"code-hardening"},"Code Hardening"),(0,r.kt)("p",null,"The community version directly loads original dlls, forcing developers to carry and download original dlls. These original dlls can be decompiled by tools like ILSpy,\ncreating serious security issues. Even if developers encrypt them, it's easy to intercept in memory and obtain decrypted dll content."),(0,r.kt)("p",null,"We provide industry-leading managed code hardening technology that effectively prevents code from being maliciously cracked and tampered with by third parties."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Technology"),(0,r.kt)("th",{parentName:"tr",align:null},"Security Rating"),(0,r.kt)("th",{parentName:"tr",align:null},"Implemented"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"global-metadata.dat encryption"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Metadata obfuscation"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50\u2b50"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Metadata encryption"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50\u2b50\u2b50\u2b50"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Structure virtualization"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50\u2b50\u2b50"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Encryption virtualization"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50\u2b50\u2b50"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Delayed decryption"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50\u2b50\u2b50"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Instruction virtualization"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50\u2b50\u2b50\u2b50\u2b50"),(0,r.kt)("td",{parentName:"tr",align:null})))),(0,r.kt)("h2",{id:"global-metadatadat-encryption"},"global-metadata.dat Encryption"),(0,r.kt)("p",null,"Encrypts global-metadata.dat to prevent malicious third parties from recovering metadata information."),(0,r.kt)("h2",{id:"metadata-obfuscation"},"Metadata Obfuscation"),(0,r.kt)("p",null,"Due to CLR's inherent mechanisms, regardless of how complex the encryption is, valid metadata information such as type, field, and function names can inevitably be obtained through reflection in memory.\nThis information must be secured by obfuscating the metadata itself, i.e., completely losing the original plaintext information at the source level to increase security."),(0,r.kt)("p",null,"Since instruction obfuscation significantly hurts performance, we only provide obfuscation for pure information types like types, fields, and functions. We primarily use virtualization technology to protect code security."),(0,r.kt)("h2",{id:"metadata-encryption"},"Metadata Encryption"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Technology"),(0,r.kt)("th",{parentName:"tr",align:null},"Structure Virtualization"),(0,r.kt)("th",{parentName:"tr",align:null},"Encryption Virtualization"),(0,r.kt)("th",{parentName:"tr",align:null},"Delayed Decryption"),(0,r.kt)("th",{parentName:"tr",align:null},"Security Rating"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Custom dll file structure"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"~string stream encryption"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50\u2b50")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"~blob stream encryption"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50\u2b50")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"~US stream encryption"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50\u2b50\u2b50")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"~table stream encryption"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50\u2b50\u2b50\u2b50")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"method body data encryption"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50\u2b50\u2b50")))),(0,r.kt)("h3",{id:"custom-dll-file-structure"},"Custom DLL File Structure"),(0,r.kt)("p",null,"Original dll files are in PE format, which we change to a custom file structure that cannot be opened by decompilation tools like ILSpy."),(0,r.kt)("p",null,"Supports structure virtualization technology, meaning each version's dll structure can be completely different, significantly increasing cracking costs."),(0,r.kt)("h3",{id:"string-stream-encryption"},"~string Stream Encryption"),(0,r.kt)("p",null,"The ~string stream stores strings used internally by metadata, such as type names and field names. Encrypting ~string stream data prevents direct retrieval of metadata strings from dll files."),(0,r.kt)("p",null,"Supports encryption virtualization technology, significantly increasing the difficulty of offline cracking."),(0,r.kt)("h3",{id:"blob-stream-encryption"},"~blob stream encryption"),(0,r.kt)("p",null,"The ~blob stream stores some complex metadata (such as type signatures). Encrypting the ~blob stream makes it impossible to directly obtain the original blob data from the dll file."),(0,r.kt)("p",null,"Supports encryption virtualization technology, significantly increasing the cost of offline cracking."),(0,r.kt)("h3",{id:"us-stream-encryption"},"~US stream encryption"),(0,r.kt)("p",null,"The ~US stream stores user string (i.e., strings used in code) metadata."),(0,r.kt)("p",null,"Supports encryption virtualization technology, preventing crackers from directly obtaining the original ~US metadata from dll files."),(0,r.kt)("p",null,"Supports delayed decryption, preventing crackers from using memory dump techniques to directly restore all data."),(0,r.kt)("h3",{id:"table-stream-encryption"},"~table stream encryption"),(0,r.kt)("p",null,"The ~table stream stores most structured metadata."),(0,r.kt)("p",null,"Supports structural virtualization technology, with each version using different metadata data structures, greatly increasing the cost of cracking. Even if cracked, it cannot be restored to the original ~table stream structure through simple data movement or copying."),(0,r.kt)("p",null,"Supports encryption virtualization, significantly improving the cost of cracking."),(0,r.kt)("p",null,"Supports delayed decryption, preventing crackers from using memory dump techniques to directly restore all data."),(0,r.kt)("h3",{id:"method-body-data-encryption"},"method body data encryption"),(0,r.kt)("p",null,"method body stores function body metadata information."),(0,r.kt)("p",null,"Supports encryption virtualization, significantly improving the cost of cracking."),(0,r.kt)("p",null,"Supports delayed decryption, preventing crackers from using memory dump techniques to directly restore all data."),(0,r.kt)("h2",{id:"structural-virtualization-technology"},"Structural Virtualization Technology"),(0,r.kt)("p",null,"Structural virtualization technology refers to using completely random metadata structures, using a dedicated structural virtual machine to parse the metadata structure, and can be dynamically adjusted without rebuilding the App, making crackers need to re-crack each version, greatly increasing the cost for crackers."),(0,r.kt)("h2",{id:"encryption-virtualization-technology"},"Encryption Virtualization Technology"),(0,r.kt)("p",null,"Encryption virtualization technology refers to using completely random encryption methods, using a dedicated encryption virtual machine to encrypt metadata, and can be dynamically adjusted without rebuilding the App, making crackers need to re-crack each version, greatly increasing the cost for crackers."),(0,r.kt)("h2",{id:"delayed-decryption-technology"},"Delayed Decryption Technology"),(0,r.kt)("p",null,"Delayed decryption technology refers to decrypting data only when first accessed, effectively preventing crackers from hooking critical paths and directly dumping complete original data from memory."),(0,r.kt)("h2",{id:"instruction-virtualization-technology"},"Instruction Virtualization Technology"),(0,r.kt)("p",null,"Instruction virtualization technology refers to converting original IL instructions into custom register virtual machine instructions, effectively preventing crackers from using existing decompilation tools to analyze original code."),(0,r.kt)("p",null,"Instruction virtualization technology supports randomized instruction structures. Each time the App is rebuilt (to improve instruction decoding performance, unlike structure virtualization and encryption virtualization which support dynamic adjustment), a completely new instruction set (with completely different instruction numbers and instruction lengths) is used, greatly increasing the cost for crackers."),(0,r.kt)("h2",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"The Encryption field in ",(0,r.kt)("inlineCode",{parentName:"p"},"HybridCLR Settings")," configures hardening-related parameters."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Must Match Main Package When Encrypting dll"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"encryptGlobalMetdataDat"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"Encrypt global-metadata.dat file")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"vmSeed"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Randomization seed for encryption virtual machine")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"metadataSeed"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Randomization encryption seed for metadata")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"key"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Encryption parameters used for encryption/decryption")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"stringEncCodeLength"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Encryption instruction length for ~string stream")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"blobEncCodeLength"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Encryption instruction length for ~blob stream")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"userStringEncCodeLength"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Encryption instruction length for ~US stream")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"tableEncCodeLength"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Encryption instruction length for ~table stream")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"lazyUserStringEncCodeLength"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Delayed encryption instruction length for ~US stream")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"methdBodyEncCodeLength"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Delayed encryption instruction length for ~function body")))),(0,r.kt)("p",null,"vmSeed is the randomization seed for the encryption virtual machine. This random seed affects the generated encryption virtual machine code and is compiled into the main package's native code. Therefore, when generating encrypted dlls, ensure that vmSeed matches the vmSeed used when packaging the main package.\nIt is recommended to modify this parameter each time a new main package is released."),(0,r.kt)("p",null,"metadataSeed and key are both dynamic parameters and do not need to match the main package. These values can be modified each time hot update dlls are encrypted. It is recommended to modify these values after a period of time or after several versions."),(0,r.kt)("p",null,"xxEncCodeLength is the length of encryption instructions. The larger the value, the more complex the encryption, and decryption time is proportional to the encryption instruction length. Since the decryption process brings certain overhead, it is recommended to use default values. If loading encrypted hot update assemblies takes too long, these values can be appropriately reduced."),(0,r.kt)("h2",{id:"encrypt-hot-update-dll"},"Encrypt hot update dll"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"HybridCLR.Editor.Encryption.EncryptUtil")," class is provided to encrypt dlls. Example code is as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},"    public static void EncryptDll(string originalDll, string encryptedDll)\n    {\n        HybridCLR.Editor.Encryption.EncryptionUtil.EncryptDll(originalDll, encryptedDll, SettingsUtil.EncryptionSettings);\n    }\n\n")),(0,r.kt)("h2",{id:"runtime-loading-of-hot-update-dll"},"Runtime loading of hot update dll"),(0,r.kt)("p",null,"There is no difference from ordinary hot update dlls, just use ",(0,r.kt)("inlineCode",{parentName:"p"},"Assembly.Load"),"."),(0,r.kt)("p",null,"Supplementary metadata dlls can also be encrypted, and the loading method is the same as when unencrypted."))}u.isMDXComponent=!0}}]);