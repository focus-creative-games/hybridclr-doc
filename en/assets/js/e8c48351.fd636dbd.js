"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2896],{3905:(e,t,i)=>{i.d(t,{Zo:()=>s,kt:()=>h});var n=i(7294);function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function l(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach((function(t){r(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function o(e,t){if(null==e)return{};var i,n,r=function(e,t){if(null==e)return{};var i,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)i=a[n],t.indexOf(i)>=0||(r[i]=e[i]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)i=a[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}var p=n.createContext({}),c=function(e){var t=n.useContext(p),i=t;return e&&(i="function"==typeof e?e(t):l(l({},t),e)),i},s=function(e){var t=c(e.components);return n.createElement(p.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var i=e.components,r=e.mdxType,a=e.originalType,p=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),d=c(i),m=r,h=d["".concat(p,".").concat(m)]||d[m]||u[m]||a;return i?n.createElement(h,l(l({ref:t},s),{},{components:i})):n.createElement(h,l({ref:t},s))}));function h(e,t){var i=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=i.length,l=new Array(a);l[0]=m;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[d]="string"==typeof e?e:r,l[1]=o;for(var c=2;c<a;c++)l[c]=i[c];return n.createElement.apply(null,l)}return n.createElement.apply(null,i)}m.displayName="MDXCreateElement"},7991:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>o,toc:()=>c});var n=i(7462),r=(i(7294),i(3905));const a={},l="HybridCLR packaging workflow",o={unversionedId:"basic/buildpipeline",id:"basic/buildpipeline",title:"HybridCLR packaging workflow",description:"Due to the requirements of the hot update itself and some limitations of Unity resource management, some special processing is required for the packaging workflow, which is mainly divided into several parts:",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/basic/buildpipeline.md",sourceDirName:"basic",slug:"/basic/buildpipeline",permalink:"/en/docs/basic/buildpipeline",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Load and use hot update code",permalink:"/en/docs/basic/runhotupdatecodes"},next:{title:"Code clipping problem",permalink:"/en/docs/basic/codestriping"}},p={},c=[{value:"Packaging process",id:"packaging-process",level:2},{value:"Special handling for iOS platform",id:"special-handling-for-ios-platform",level:2},{value:"Compile libil2cpp.a",id:"compile-libil2cppa",level:2},{value:"Common errors",id:"common-errors",level:2}],s={toc:c},d="wrapper";function u(e){let{components:t,...i}=e;return(0,r.kt)(d,(0,n.Z)({},s,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"hybridclr-packaging-workflow"},"HybridCLR packaging workflow"),(0,r.kt)("p",null,"Due to the requirements of the hot update itself and some limitations of Unity resource management, some special processing is required for the packaging workflow, which is mainly divided into several parts:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Set the UNITY_IL2CPP_PATH environment variable"),(0,r.kt)("li",{parentName:"ul"},"Automatically exclude hot update assembly when packaging"),(0,r.kt)("li",{parentName:"ul"},"Add the hot update dll name to the assembly list when packaging"),(0,r.kt)("li",{parentName:"ul"},"Copy the trimmed aot dll generated during the packaging process for supplementary metadata"),(0,r.kt)("li",{parentName:"ul"},"Compile hot update dll"),(0,r.kt)("li",{parentName:"ul"},"Generate some files and codes needed for packaging"),(0,r.kt)("li",{parentName:"ul"},"Special handling for iOS platform")),(0,r.kt)("p",null,"Manually operating these is cumbersome and error-prone. The ",(0,r.kt)("inlineCode",{parentName:"p"},"com.code-philosophy.hybridclr")," package contains standard tool scripts related to packaging workflows, simplifying these complex processes into one-click operations.\nFor detailed implementation, please refer to the source code or ",(0,r.kt)("a",{parentName:"p",href:"/en/docs/basic/com.code-philosophy.hybridclr"},"com.code-philosophy.hybridclr introduction")),(0,r.kt)("h2",{id:"packaging-process"},"Packaging process"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Run the menu ",(0,r.kt)("inlineCode",{parentName:"li"},"HybridCLR/Generate/All")," to execute the necessary generation operations with one click"),(0,r.kt)("li",{parentName:"ol"},"Add the hot update dll under ",(0,r.kt)("inlineCode",{parentName:"li"},"HybridCLRData/HotUpdateDlls")," to the hot update resource management system of the project"),(0,r.kt)("li",{parentName:"ol"},"Add the supplementary metadata dll under ",(0,r.kt)("inlineCode",{parentName:"li"},"HybridCLRData/AssembliesPostIl2CppStrip")," to the hot update resource management system of the project"),(0,r.kt)("li",{parentName:"ol"},"Pack according to the original packaging process of your project")),(0,r.kt)("h2",{id:"special-handling-for-ios-platform"},"Special handling for iOS platform"),(0,r.kt)("p",null,"Platforms other than iOS compile the target program based on the libil2cpp source code, and the iOS platform uses the pre-compiled libil2cpp.a file. The xcode project exported by Unity references the pre-generated libil2cpp.a, but does not contain the libil2cpp source code.\nDirect packaging cannot support hot updates. Therefore, when compiling an iOS program, you need to compile libil2cpp.a separately, then ",(0,r.kt)("strong",{parentName:"p"},"replace the libil2cpp.a file")," of the xcode project, and then package it."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Please replace the libil2cpp.a file in the xcode project by yourself"),"."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"com.code-philosophy.hybridclr/Data~/iOSBuild")," directory contains the scripts needed to compile ",(0,r.kt)("inlineCode",{parentName:"p"},"libil2cpp.a"),". After completing the installation using ",(0,r.kt)("inlineCode",{parentName:"p"},"HybridCLR/Installer..."),", the iOSBuild directory will be copied to the ",(0,r.kt)("inlineCode",{parentName:"p"},"{project}/HybridCLRData/iOSBuild")," directory."),(0,r.kt)("h2",{id:"compile-libil2cppa"},"Compile libil2cpp.a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Run ",(0,r.kt)("inlineCode",{parentName:"li"},"HybridCLR/Generate/All")," to generate all necessary files"),(0,r.kt)("li",{parentName:"ul"},"Open the command console and switch to the ",(0,r.kt)("inlineCode",{parentName:"li"},"{project}/HybridCLRData/iOSBuild")," directory. Please make sure the absolute path of this path does not contain spaces! Otherwise an error will occur."),(0,r.kt)("li",{parentName:"ul"},"bash ./build_libil2cpp.sh compiles libil2cpp.a. After running, if the libil2cpp.a file can be found in the ",(0,r.kt)("inlineCode",{parentName:"li"},"iOSBuild/build")," directory and the size is greater than 60M, it means the compilation is successful")),(0,r.kt)("h2",{id:"common-errors"},"Common errors"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Installation did not complete in ",(0,r.kt)("inlineCode",{parentName:"li"},"HybridCLR/Installer...")),(0,r.kt)("li",{parentName:"ul"},"Didn't run ",(0,r.kt)("inlineCode",{parentName:"li"},"HybridCLR/Generate/All")),(0,r.kt)("li",{parentName:"ul"},"Newer macOS (above 12) and latest xcode not installed"),(0,r.kt)("li",{parentName:"ul"},"cmake is not installed"),(0,r.kt)("li",{parentName:"ul"},"Due to the git settings, the pulled down build_libil2cpp.sh and build_lump.sh contain incorrect file end characters, resulting in an error in the first few lines of code when the script runs. Error messages are also obvious, such as ",(0,r.kt)("inlineCode",{parentName:"li"},"/bin/bash^M file does not exist"),". Run the command ",(0,r.kt)("inlineCode",{parentName:"li"},"cat -v build_libil2cpp.sh")," to check that the line breaks are correct. Run ",(0,r.kt)("inlineCode",{parentName:"li"},"git config --global core.autocrlf input"),", and then pull these two script files again. For details, please refer to ",(0,r.kt)("a",{parentName:"li",href:"https://docs.github.com/cn/get-started/getting-started-with-git/configuring-git-to-handle-line-endings"},"Git Line Break Settings"),"."),(0,r.kt)("li",{parentName:"ul"},"The absolute path to ",(0,r.kt)("inlineCode",{parentName:"li"},"{project}/HybridCLRData/iOSBuild")," contains spaces, causing the gen_lump.sh script to generate wrong results")))}u.isMDXComponent=!0}}]);