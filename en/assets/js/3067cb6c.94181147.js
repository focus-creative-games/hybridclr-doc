"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9511],{3905:(e,t,a)=>{a.d(t,{Zo:()=>m,kt:()=>h});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var o=n.createContext({}),d=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},m=function(e){var t=d(e.components);return n.createElement(o.Provider,{value:t},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,o=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),u=d(a),c=i,h=u["".concat(o,".").concat(c)]||u[c]||p[c]||r;return a?n.createElement(h,l(l({ref:t},m),{},{components:a})):n.createElement(h,l({ref:t},m))}));function h(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,l=new Array(r);l[0]=c;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s[u]="string"==typeof e?e:i,l[1]=s;for(var d=2;d<r;d++)l[d]=a[d];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},38801:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var n=a(87462),i=(a(67294),a(3905));const r={},l="Load Hot Update Assembly",s={unversionedId:"business/ultimate/loadassembly",id:"business/ultimate/loadassembly",title:"Load Hot Update Assembly",description:"The Ultimate edition adds DHE assemblies compared to the community edition and professional edition. Since DHE assemblies require additional parameters to instruct the runtime on how to dynamically choose between executing original AOT code or hot update code, they cannot be loaded using the Assembly.Load interface.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/business/ultimate/loadassembly.md",sourceDirName:"business/ultimate",slug:"/business/ultimate/loadassembly",permalink:"/en/docs/business/ultimate/loadassembly",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Build and Hot Update",permalink:"/en/docs/business/ultimate/build"},next:{title:"MetaVersion Workflow",permalink:"/en/docs/business/ultimate/metaversionworkflow"}},o={},d=[{value:"Supported Assembly Types",id:"supported-assembly-types",level:2},{value:"Loading Order",id:"loading-order",level:2},{value:"Load DHE Assembly",id:"load-dhe-assembly",level:2},{value:"LoadDifferentialHybridAssemblyWithDHAO",id:"loaddifferentialhybridassemblywithdhao",level:2},{value:"LoadDifferentialHybridAssemblyWithMetaVersion",id:"loaddifferentialhybridassemblywithmetaversion",level:2}],m={toc:d},u="wrapper";function p(e){let{components:t,...a}=e;return(0,i.kt)(u,(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"load-hot-update-assembly"},"Load Hot Update Assembly"),(0,i.kt)("p",null,"The Ultimate edition adds DHE assemblies compared to the community edition and professional edition. Since DHE assemblies require additional parameters to instruct the runtime on how to dynamically choose between executing original AOT code or hot update code, they cannot be loaded using the ",(0,i.kt)("inlineCode",{parentName:"p"},"Assembly.Load")," interface.\nTherefore, special loading rules are required."),(0,i.kt)("h2",{id:"supported-assembly-types"},"Supported Assembly Types"),(0,i.kt)("p",null,"The Ultimate edition is a superset of the community edition and professional edition. It supports loading both ordinary purely interpreted hot update assemblies and DHE assemblies.\nIf no DHE assemblies are configured, the Ultimate edition degrades to the professional edition (or can be considered as a community edition that runs somewhat faster)."),(0,i.kt)("h2",{id:"loading-order"},"Loading Order"),(0,i.kt)("p",null,"The Ultimate edition uses the same dependency loading rules as the community edition, i.e., if assembly B depends on assembly A, then assembly A needs to be loaded first, then assembly B."),(0,i.kt)("p",null,"Since DHE assemblies will be compiled into AOT, they cannot depend on hot update assemblies, otherwise packaging errors will occur. We have added dependency checking in ",(0,i.kt)("inlineCode",{parentName:"p"},"HybridCLR.Editor.BuildProcessors.CheckSettings")," to detect errors early."),(0,i.kt)("p",null,"Due to this characteristic, a relatively simple approach is to first load all DHE assemblies in order, then load ordinary hot update assemblies in order."),(0,i.kt)("h2",{id:"load-dhe-assembly"},"Load DHE Assembly"),(0,i.kt)("p",null,"RuntimeApi provides three interfaces for loading DHE assemblies:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"LoadOriginalDifferentialHybridAssembly is used to load DHE assemblies that have not changed at all"),(0,i.kt)("li",{parentName:"ul"},"LoadDifferentialHybridAssemblyWithDHAO is used to load DHE assemblies that have not changed or have changed, using dhao files"),(0,i.kt)("li",{parentName:"ul"},"LoadDifferentialHybridAssemblyWithMetaVersion is used to load DHE assemblies that have not changed or have changed, using meta version files")),(0,i.kt)("p",null,"When it is clear that no changes have occurred, you can call the LoadOriginalDifferentialHybridAssembly interface to indicate direct use of the original DHE assembly, only needing to pass the assembly name, without needing to pass the original DHE assembly data, because AOT already\ncontains complete original DHE assembly information."),(0,i.kt)("p",null,"Whether there are changes or not, you can call LoadDifferentialHybridAssemblyWithXxx to load DHE assemblies."),(0,i.kt)("p",null,"There are some restrictions for calling LoadOriginalDifferentialHybridAssembly:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"The DHE assemblies it depends on must also be loaded with LoadOriginalDifferentialHybridAssembly, i.e., Original loading dependency")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"AOT generic instantiation issues"),(0,i.kt)("p",{parentName:"li"},"DHE assemblies loaded with it are equivalent to ordinary AOT assemblies. If other hot update assemblies use generics from this DHE assembly, and the Unity version is less than 2021 or equals 2021 but the ",(0,i.kt)("inlineCode",{parentName:"p"},"Il2Cpp Code Generation")," option also has AOT generic instantiation issues.\nAlthough supplementary metadata can solve this problem, a better approach is to switch to LoadOriginalDifferentialHybridAssembly loading."))),(0,i.kt)("p",null,"Actual projects may have many DHE assemblies, and determining which interface each DHE assembly should use for loading is difficult. Even determining whether an assembly has changed is not an easy task.\nWe recommend using the following simple rules:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"After releasing the main package, when no hot updates have occurred, use LoadOriginalDifferentialHybridAssembly to load all DHE assemblies"),(0,i.kt)("li",{parentName:"ul"},"After releasing hot updates, regardless of whether there are changes, uniformly use LoadDifferentialHybridAssemblyWithXxx to load DHE assemblies")),(0,i.kt)("h2",{id:"loaddifferentialhybridassemblywithdhao"},"LoadDifferentialHybridAssemblyWithDHAO"),(0,i.kt)("p",null,"This function has the following parameters:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"currentDllBytes"),(0,i.kt)("td",{parentName:"tr",align:null},"File content of the latest DHE assembly")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"currentDllSymbolBytes"),(0,i.kt)("td",{parentName:"tr",align:null},"pdb file content of the latest DHE assembly, this parameter can be null")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"dhaoBytes"),(0,i.kt)("td",{parentName:"tr",align:null},"dhao file content generated using the latest DHE assembly")))),(0,i.kt)("h2",{id:"loaddifferentialhybridassemblywithmetaversion"},"LoadDifferentialHybridAssemblyWithMetaVersion"),(0,i.kt)("p",null,"This function has the following parameters:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"currentDllBytes"),(0,i.kt)("td",{parentName:"tr",align:null},"File content of the latest DHE assembly")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"currentDllSymbolBytes"),(0,i.kt)("td",{parentName:"tr",align:null},"pdb file content of the latest DHE assembly, this parameter can be null")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"originalMetaVersinFileBytes"),(0,i.kt)("td",{parentName:"tr",align:null},"meta version file content of the original DHE assembly")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"currentMetaVersionFileBytes"),(0,i.kt)("td",{parentName:"tr",align:null},"meta version file content of the latest DHE assembly")))),(0,i.kt)("p",null,"originalMetaVersinFileBytes is completely determined when building the main package and corresponds one-to-one with that main package. We strongly recommend adding it to the StreamingAssets directory to carry with the package."))}p.isMDXComponent=!0}}]);