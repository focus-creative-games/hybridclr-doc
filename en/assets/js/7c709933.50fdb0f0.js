"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1811],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>m});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},d=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=c(a),h=r,m=p["".concat(l,".").concat(h)]||p[h]||u[h]||o;return a?n.createElement(m,i(i({ref:t},d),{},{components:a})):n.createElement(m,i({ref:t},d))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},45588:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var n=a(87462),r=(a(67294),a(3905));const o={},i="Best Practices",s={unversionedId:"basic/bestpractice",id:"basic/bestpractice",title:"Best Practices",description:"Unity version recommendation",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/basic/bestpractice.md",sourceDirName:"basic",slug:"/basic/bestpractice",permalink:"/en/docs/basic/bestpractice",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Hybridclr Package",permalink:"/en/docs/basic/com.code-philosophy.hybridclr"},next:{title:"Migrate from netstandard to .Net Framework",permalink:"/en/docs/basic/migratefromnetstandard"}},l={},c=[{value:"Unity version recommendation",id:"unity-version-recommendation",level:2},{value:"It is recommended to mount the startup script to the first loaded hot update scene after the hot update is completed",id:"it-is-recommended-to-mount-the-startup-script-to-the-first-loaded-hot-update-scene-after-the-hot-update-is-completed",level:2},{value:"When <code>RuntimeApi.LoadMetadataForAOTAssembly</code> is called",id:"when-runtimeapiloadmetadataforaotassembly-is-called",level:2},{value:"Do not use reflection to interact with native and interpreter performance-sensitive occasions, you should use Delegate or virtual function",id:"do-not-use-reflection-to-interact-with-native-and-interpreter-performance-sensitive-occasions-you-should-use-delegate-or-virtual-function",level:2},{value:"The hot update layer returns a Delegate",id:"the-hot-update-layer-returns-a-delegate",level:3},{value:"Through Delegate.Create, create the corresponding Delegate according to MethodInfo",id:"through-delegatecreate-create-the-corresponding-delegate-according-to-methodinfo",level:3},{value:"2021 version don&#39;t use <code>faster(smaller) builds</code> option",id:"2021-version-dont-use-fastersmaller-builds-option",level:2}],d={toc:c},p="wrapper";function u(e){let{components:t,...a}=e;return(0,r.kt)(p,(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"best-practices"},"Best Practices"),(0,r.kt)("h2",{id:"unity-version-recommendation"},"Unity version recommendation"),(0,r.kt)("p",null,"It is recommended to use ",(0,r.kt)("inlineCode",{parentName:"p"},"2020.3.x(x >= 21)")," series and ",(0,r.kt)("inlineCode",{parentName:"p"},"2021.3.x")," series, which are the most stable."),(0,r.kt)("h2",{id:"it-is-recommended-to-mount-the-startup-script-to-the-first-loaded-hot-update-scene-after-the-hot-update-is-completed"},"It is recommended to mount the startup script to the first loaded hot update scene after the hot update is completed"),(0,r.kt)("p",null,"It is recommended to mount the startup script to the startup hot update scene, so that the non-hot update project can be transformed into a hot update project with zero changes, and no reflection operation is required."),(0,r.kt)("h2",{id:"when-runtimeapiloadmetadataforaotassembly-is-called"},"When ",(0,r.kt)("inlineCode",{parentName:"h2"},"RuntimeApi.LoadMetadataForAOTAssembly")," is called"),(0,r.kt)("p",null,"You just need to call it before using AOT generics (you only need to call it once). In theory, the earlier the loading, the better. In practice, a more reasonable time is after the hot update is completed, or after the hot update dll is loaded but before any code is executed. If the dll that supplements the metadata is also entered into the main package as an additional data file, it will be better loaded when the main project starts. Please refer to ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/focus-creative-games/hybridclr_trial"},"HybridCLR_trial")," project"),(0,r.kt)("h2",{id:"do-not-use-reflection-to-interact-with-native-and-interpreter-performance-sensitive-occasions-you-should-use-delegate-or-virtual-function"},"Do not use reflection to interact with native and interpreter performance-sensitive occasions, you should use Delegate or virtual function"),(0,r.kt)("p",null,"Taking the Update function as an example, most people would think that the interaction between the main project and the update part is like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'var klass = ass. GetType("App");\nvar method = klass. GetMethod("Update");\nmethod.Invoke(null, new object[] {deltaTime});\n')),(0,r.kt)("p",null,"The disadvantage of this method is that the cost of reflection is high. In case there are parameters and additional gc, there is actually a more efficient method. There are two main ways:"),(0,r.kt)("h3",{id:"the-hot-update-layer-returns-a-delegate"},"The hot update layer returns a Delegate"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'// Hotfix.asmdf hot update part\nclass app\n{\n     public static Action<float> GetUpdateDelegate()\n     {\n         return Update;\n     }\n\n     public static void Update(float deltaTime)\n     {\n     }\n}\n\n// Main.asmdf main project\nvar klass = ass. GetType("App");\nvar method = klass. GetMethod("GetUpdateDelegate");\nvar updateDel = (Action<float>)method. Invoke(null, null);\n\nupdateDel(deltaTime);\n')),(0,r.kt)("h3",{id:"through-delegatecreate-create-the-corresponding-delegate-according-to-methodinfo"},"Through Delegate.Create, create the corresponding Delegate according to MethodInfo"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'var klass = ass. GetType("App");\nvar method = klass. GetMethod("Update");\nupdateDel = (Action<float>)System.Delegate.CreateDelegate(typeof(Action<float>), null, method);\nupdateDel(deltaTime);\n')),(0,r.kt)("h2",{id:"2021-version-dont-use-fastersmaller-builds-option"},"2021 version don't use ",(0,r.kt)("inlineCode",{parentName:"h2"},"faster(smaller) builds")," option"),(0,r.kt)("p",null,"Since the 2021.3.x LTS version, il2cpp has fully supported the ",(0,r.kt)("inlineCode",{parentName:"p"},"full generic sharing")," technology. When the ",(0,r.kt)("inlineCode",{parentName:"p"},"Il2Cpp Code Generation")," option in Build Settings is ",(0,r.kt)("inlineCode",{parentName:"p"},"faster runtime"),", it is a standard generic sharing mechanism, and ",(0,r.kt)("inlineCode",{parentName:"p"},"faster(smaller) builds")," open when\n",(0,r.kt)("inlineCode",{parentName:"p"},"full generic sharing")," mechanism."),(0,r.kt)("p",null,"When ",(0,r.kt)("inlineCode",{parentName:"p"},"full generic sharing")," is enabled, each generic function (regardless of whether the generic parameter is a value type or a class type) will completely sharing a code. The advantage is to save the size of the package body, and the disadvantage is that it greatly hurts the performance of the generic function . The fully generic shared code is sometimes several to ten times slower than the standard generic shared code, and even worse than the purely interpreted version. Therefore it is strongly recommended to ",(0,r.kt)("strong",{parentName:"p"},"not enable")," the ",(0,r.kt)("inlineCode",{parentName:"p"},"faster(smaller) builds")," option."))}u.isMDXComponent=!0}}]);