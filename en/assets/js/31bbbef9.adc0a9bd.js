"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3134],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,s=e.originalType,l=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),d=c(n),m=o,h=d["".concat(l,".").concat(m)]||d[m]||u[m]||s;return n?a.createElement(h,i(i({ref:t},p),{},{components:n})):a.createElement(h,i({ref:t},p))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var s=n.length,i=new Array(s);i[0]=m;var r={};for(var l in t)hasOwnProperty.call(t,l)&&(r[l]=t[l]);r.originalType=e,r[d]="string"==typeof e?e:o,i[1]=r;for(var c=2;c<s;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},50141:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>r,toc:()=>c});var a=n(87462),o=(n(67294),n(3905));const s={},i="MonoBehaviour Support",r={unversionedId:"basic/monobehaviour",id:"basic/monobehaviour",title:"MonoBehaviour Support",description:"HybridCLR fully supports hot update MonoBehaviour and ScriptableObject workflows, allowing you to add hot update scripts to GameObjects in code or directly attach hot update scripts to assets. However, due to the special nature of Unity's asset management mechanism, attaching hot update scripts to assets requires some special handling in the packaging workflow.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/basic/monobehaviour.md",sourceDirName:"basic",slug:"/basic/monobehaviour",permalink:"/en/docs/basic/monobehaviour",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Code Stripping",permalink:"/en/docs/basic/codestriping"},next:{title:"PInvoke Support",permalink:"/en/docs/basic/pinvoke"}},l={},c=[{value:"Usage Through Code",id:"usage-through-code",level:2},{value:"Attaching MonoBehaviour to Assets or Creating ScriptableObject Type Assets",id:"attaching-monobehaviour-to-assets-or-creating-scriptableobject-type-assets",level:2},{value:"Assembly List File",id:"assembly-list-file",level:2},{value:"Known Issues",id:"known-issues",level:2},{value:"GameObject.GetComponent(string name) Interface Cannot Get Components",id:"gameobjectgetcomponentstring-name-interface-cannot-get-components",level:3},{value:"Other Notes",id:"other-notes",level:2}],p={toc:c},d="wrapper";function u(e){let{components:t,...n}=e;return(0,o.kt)(d,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"monobehaviour-support"},"MonoBehaviour Support"),(0,o.kt)("p",null,"HybridCLR fully supports hot update MonoBehaviour and ScriptableObject workflows, allowing you to add hot update scripts to GameObjects in code or directly attach hot update scripts to assets. However, due to the special nature of Unity's asset management mechanism, attaching hot update scripts to assets requires some special handling in the packaging workflow."),(0,o.kt)("h2",{id:"usage-through-code"},"Usage Through Code"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"AddComponent<T>()")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"AddComponent(Type type)")," are perfectly supported at any time. You just need to load the hot update DLL into the runtime using Assembly.Load beforehand."),(0,o.kt)("h2",{id:"attaching-monobehaviour-to-assets-or-creating-scriptableobject-type-assets"},"Attaching MonoBehaviour to Assets or Creating ScriptableObject Type Assets"),(0,o.kt)("p",null,"Unity's asset management system requires the following conditions to be met when deserializing hot update scripts in assets:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"The DLL containing the script must already be loaded into the runtime"),(0,o.kt)("li",{parentName:"ol"},"Must be assets packaged using AssetBundle (",(0,o.kt)("strong",{parentName:"li"},"frameworks that indirectly use AB like Addressable also work"),")"),(0,o.kt)("li",{parentName:"ol"},"The DLL containing the script must be added to the assembly list file generated during packaging. This list file is loaded at Unity startup and is immutable data. Different Unity versions have different list file names and formats.")),(0,o.kt)("p",null,"If no special processing is done to the packaging process, since hot update DLLs are removed in the ",(0,o.kt)("inlineCode",{parentName:"p"},"IFilterBuildAssemblies")," callback, they definitely won't appear in the assembly list file. Due to not meeting condition 3, hot update scripts attached to hot update assets cannot be restored, and ",(0,o.kt)("inlineCode",{parentName:"p"},"Scripting Missing")," errors will occur at runtime."),(0,o.kt)("p",null,"Therefore, we've made special handling in the ",(0,o.kt)("inlineCode",{parentName:"p"},"Editor/BuildProcessors/PatchScriptingAssemblyList.cs")," script to add hot update DLLs to the assembly list file. You need to add hot update assemblies in your project to the ",(0,o.kt)("inlineCode",{parentName:"p"},"HotUpdateAssemblyDefinitions or HotUpdateAssemblies fields in HybridCLRSettings configuration"),"."),(0,o.kt)("p",null,"Only hot update assets are restricted to be packaged as AB bundles; there are no restrictions on hot update DLL packaging methods. You can ",(0,o.kt)("strong",{parentName:"p"},"freely choose hot update methods")," according to project requirements, packaging DLLs into AB, as raw data files, or with encryption and compression, etc. Just ensure they're loaded using Assembly.Load before loading hot update assets."),(0,o.kt)("admonition",{type:"warning"},(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("strong",{parentName:"p"},"If hot update scripts are attached to assets like Resources that ship with the main package, scripting missing errors will occur!")," However, if you first package them as AssetBundle packages and then place them under Resources, loading that bundled AssetBundle at runtime works fine.")),(0,o.kt)("h2",{id:"assembly-list-file"},"Assembly List File"),(0,o.kt)("p",null,"Different Unity versions have different names and formats for assembly list files."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"2019 version: globalgamemanagers file when uncompressed; saved to globalgamemanagers file then packaged with other files into data.unity3d file in BundleFile format when compressed."),(0,o.kt)("li",{parentName:"ul"},"2020-2021 versions: Saved in ScriptingAssembles.json file.")),(0,o.kt)("h2",{id:"known-issues"},"Known Issues"),(0,o.kt)("h3",{id:"gameobjectgetcomponentstring-name-interface-cannot-get-components"},"GameObject.GetComponent(string name) Interface Cannot Get Components"),(0,o.kt)("p",null,"This is a known bug related to Unity's code implementation. Only hot update scripts attached to hot update assets have this problem; hot update scripts added through AddComponent in code can be found using this method. If you encounter this issue, please use ",(0,o.kt)("inlineCode",{parentName:"p"},"GameObject.GetComponent<T>()")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"GameObject.GetComponent(typeof(T))")," instead."),(0,o.kt)("h2",{id:"other-notes"},"Other Notes"),(0,o.kt)("p",null,"Don't modify the DLL names of scripts that need to be attached to assets after going live, because the assembly list file cannot be modified after packaging."),(0,o.kt)("p",null,"It's recommended not to disable TypeTree when building AB, otherwise normal AB loading methods will fail. (The reason is that for scripts with disabled TypeTree, Unity performs signature verification to prevent process crashes during MonoBehaviour deserialization due to binary mismatches. The signature content is a hash generated from the script's FullName and TypeTree data, but since our hot update script information doesn't exist in the packaged installation, verification will definitely fail)"),(0,o.kt)("p",null,"If you must disable TypeTree, a workaround is to disable script hash verification. In this case, users must ensure code and asset version consistency during packaging, otherwise crashes may occur. Example code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},"    AssetBundleCreateRequest req = AssetBundle.LoadFromFileAsync(path);\n    req.SetEnableCompatibilityChecks(false); // Non-public, needs to be called through reflection\n")))}u.isMDXComponent=!0}}]);