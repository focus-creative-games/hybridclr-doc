"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9511],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>h});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var o=a.createContext({}),d=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},m=function(e){var t=d(e.components);return a.createElement(o.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,o=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),p=d(n),c=i,h=p["".concat(o,".").concat(c)]||p[c]||u[c]||r;return n?a.createElement(h,s(s({ref:t},m),{},{components:n})):a.createElement(h,s({ref:t},m))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,s=new Array(r);s[0]=c;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l[p]="string"==typeof e?e:i,s[1]=l;for(var d=2;d<r;d++)s[d]=n[d];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},8801:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var a=n(7462),i=(n(7294),n(3905));const r={},s="Loading Hot Update Assemblies",l={unversionedId:"business/ultimate/loadassembly",id:"business/ultimate/loadassembly",title:"Loading Hot Update Assemblies",description:"The flagship version introduces Differential Hybrid Assemblies (DHE) in addition to the community and professional versions. Since DHE assemblies require additional parameters to indicate how the runtime should dynamically select between the original AOT code and the hot update code, they cannot be loaded using the Assembly.Load interface. Therefore, a special loading mechanism is required.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/business/ultimate/loadassembly.md",sourceDirName:"business/ultimate",slug:"/business/ultimate/loadassembly",permalink:"/en/docs/business/ultimate/loadassembly",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Building and Hot Updating",permalink:"/en/docs/business/ultimate/build"},next:{title:"MetaVersion Workflow",permalink:"/en/docs/business/ultimate/metaversionworkflow"}},o={},d=[{value:"Supported Assembly Types",id:"supported-assembly-types",level:2},{value:"Loading Order",id:"loading-order",level:2},{value:"Loading DHE Assemblies",id:"loading-dhe-assemblies",level:2},{value:"LoadDifferentialHybridAssemblyWithMetaVersion",id:"loaddifferentialhybridassemblywithmetaversion",level:2}],m={toc:d},p="wrapper";function u(e){let{components:t,...n}=e;return(0,i.kt)(p,(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"loading-hot-update-assemblies"},"Loading Hot Update Assemblies"),(0,i.kt)("p",null,"The flagship version introduces Differential Hybrid Assemblies (DHE) in addition to the community and professional versions. Since DHE assemblies require additional parameters to indicate how the runtime should dynamically select between the original AOT code and the hot update code, they cannot be loaded using the ",(0,i.kt)("inlineCode",{parentName:"p"},"Assembly.Load")," interface. Therefore, a special loading mechanism is required."),(0,i.kt)("h2",{id:"supported-assembly-types"},"Supported Assembly Types"),(0,i.kt)("p",null,"The flagship version is a superset of the community and professional versions, supporting both ordinary interpreted hot update assemblies and DHE assemblies. If no DHE assemblies are configured, the flagship version degrades to the professional version (or can be considered a slightly faster community version)."),(0,i.kt)("h2",{id:"loading-order"},"Loading Order"),(0,i.kt)("p",null,"The flagship version uses the same dependency loading rules as the community version. Specifically, if Assembly B depends on Assembly A, Assembly A must be loaded before Assembly B."),(0,i.kt)("p",null,"Since DHE assemblies are compiled into AOT, they cannot depend on hot update assemblies; otherwise, packaging will fail. We have added dependency checks in ",(0,i.kt)("inlineCode",{parentName:"p"},"HybridCLR.Editor.BuildProcessors.CheckSettings")," to detect errors early."),(0,i.kt)("p",null,"Given this characteristic, a simple approach is to load all DHE assemblies in order first, followed by loading ordinary hot update assemblies in order."),(0,i.kt)("h2",{id:"loading-dhe-assemblies"},"Loading DHE Assemblies"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"RuntimeApi")," provides two interfaces for loading DHE assemblies:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"LoadOriginalDifferentialHybridAssembly"),": Used to load DHE assemblies that have not changed."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"LoadDifferentialHybridAssemblyWithMetaVersion"),": Used to load DHE assemblies that may or may not have changed.")),(0,i.kt)("p",null,"When it is certain that no changes have occurred, the ",(0,i.kt)("inlineCode",{parentName:"p"},"LoadOriginalDifferentialHybridAssembly")," interface can be called to indicate the use of the original DHE assembly. Only the assembly name needs to be passed, without the original DHE assembly data, as the AOT already contains the complete original DHE assembly information."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"LoadDifferentialHybridAssemblyWithMetaVersion")," interface can be used regardless of whether changes have occurred."),(0,i.kt)("p",null,"There are some limitations when using ",(0,i.kt)("inlineCode",{parentName:"p"},"LoadOriginalDifferentialHybridAssembly"),":"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"Original Loading Dependency"),": Any DHE assemblies it depends on must also be loaded using ",(0,i.kt)("inlineCode",{parentName:"li"},"LoadOriginalDifferentialHybridAssembly"),"."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"AOT Generic Instantiation Issues"),": Loading DHE assemblies with this method is equivalent to loading ordinary AOT assemblies. If other hot update assemblies use generics from this DHE assembly and the Unity version is less than 2021 or equal to 2021 with the ",(0,i.kt)("inlineCode",{parentName:"li"},"Il2Cpp Code Generation")," option enabled, AOT generic instantiation issues may arise. Although these issues can be resolved by supplementing metadata, a better approach is to use ",(0,i.kt)("inlineCode",{parentName:"li"},"LoadDifferentialHybridAssemblyWithMetaVersion"),".")),(0,i.kt)("p",null,"In practice, a project may have many DHE assemblies, and determining which interface to use for each DHE assembly can be challenging. Even determining whether an assembly has changed is not straightforward. We recommend the following simple rules:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"After the main package is released and no hot updates have occurred, use ",(0,i.kt)("inlineCode",{parentName:"li"},"LoadOriginalDifferentialHybridAssembly")," to load all DHE assemblies."),(0,i.kt)("li",{parentName:"ul"},"After a hot update is released, use ",(0,i.kt)("inlineCode",{parentName:"li"},"LoadDifferentialHybridAssemblyWithMetaVersion")," to load DHE assemblies regardless of whether they have changed.")),(0,i.kt)("h2",{id:"loaddifferentialhybridassemblywithmetaversion"},"LoadDifferentialHybridAssemblyWithMetaVersion"),(0,i.kt)("p",null,"This function has four parameters:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"currentDllBytes")),(0,i.kt)("td",{parentName:"tr",align:null},"The content of the latest DHE assembly file.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"currentDllSymbolBytes")),(0,i.kt)("td",{parentName:"tr",align:null},"The content of the pdb file for the latest DHE assembly. This parameter can be ",(0,i.kt)("inlineCode",{parentName:"td"},"null"),".")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"originalMetaVersionFileBytes")),(0,i.kt)("td",{parentName:"tr",align:null},"The content of the meta version file for the original DHE assembly.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"currentMetaVersionFileBytes")),(0,i.kt)("td",{parentName:"tr",align:null},"The content of the meta version file for the latest DHE assembly.")))),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"originalMetaVersionFileBytes")," is fully determined during the main package build and is specific to that main package. We strongly recommend including it in the StreamingAssets directory and packaging it with the main package."))}u.isMDXComponent=!0}}]);