"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5638],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>y});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var m=n.createContext({}),l=function(e){var t=n.useContext(m),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},p=function(e){var t=l(e.components);return n.createElement(m.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,o=e.originalType,m=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=l(a),u=i,y=c["".concat(m,".").concat(u)]||c[u]||d[u]||o;return a?n.createElement(y,r(r({ref:t},p),{},{components:a})):n.createElement(y,r({ref:t},p))}));function y(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=a.length,r=new Array(o);r[0]=u;var s={};for(var m in t)hasOwnProperty.call(t,m)&&(s[m]=t[m]);s.originalType=e,s[c]="string"==typeof e?e:i,r[1]=s;for(var l=2;l<o;l++)r[l]=a[l];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},67265:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>m,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var n=a(87462),i=(a(67294),a(3905));const o={},r="Metadata Optimization",s={unversionedId:"business/metadataoptimization",id:"business/metadataoptimization",title:"Metadata Optimization",description:"HybridCLR doesn't consume additional memory during code execution, but loading assembly metadata occupies a large amount of memory. For scenarios with significant memory pressure (such as WeChat mini-games), this could be a problem.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/business/metadataoptimization.md",sourceDirName:"business",slug:"/business/metadataoptimization",permalink:"/en/docs/business/metadataoptimization",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Full Generic Sharing",permalink:"/en/docs/business/fullgenericsharing"},next:{title:"Hotfix Dynamic Hot Repair",permalink:"/en/docs/business/hotfix"}},m={},l=[{value:"Full Generic Sharing",id:"full-generic-sharing",level:2},{value:"Optimizing Supplemental Metadata Memory",id:"optimizing-supplemental-metadata-memory",level:2},{value:"Optimizing Hot Update Assembly Memory",id:"optimizing-hot-update-assembly-memory",level:2}],p={toc:l},c="wrapper";function d(e){let{components:t,...o}=e;return(0,i.kt)(c,(0,n.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"metadata-optimization"},"Metadata Optimization"),(0,i.kt)("p",null,"HybridCLR doesn't consume additional memory during code execution, but loading assembly metadata occupies a large amount of memory. For scenarios with significant memory pressure (such as WeChat mini-games), this could be a problem.\nFor this situation, all commercial versions significantly optimize metadata memory."),(0,i.kt)("p",null,"Memory usage is optimized from several aspects:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Using full generic sharing technology"),(0,i.kt)("li",{parentName:"ul"},"Optimizing supplemental metadata assembly loading memory"),(0,i.kt)("li",{parentName:"ul"},"Optimizing hot update assembly metadata memory")),(0,i.kt)("p",null,"Additionally, the Assembly.Load time for loading hot update assemblies has been significantly optimized, ",(0,i.kt)("strong",{parentName:"p"},"with commercial version loading time being 30% of the community version"),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"According to current test results, on 64-bit platforms, commercial versions save approximately ",(0,i.kt)("inlineCode",{parentName:"strong"},"{total supplemental metadata size} * 4 + {total hot update assembly size} * 1.8")," memory compared to community versions.")),(0,i.kt)("p",null,"For WebGL platforms (including WeChat mini-games), enabling the faster(smaller) build option will further reduce package size (approximately 1-2 times the size of all aot dlls), leading to significantly reduced memory usage.\nFor most projects, commercial versions can ultimately reduce WebGL platform memory by nearly 50-100M or even more."),(0,i.kt)("h2",{id:"full-generic-sharing"},"Full Generic Sharing"),(0,i.kt)("p",null,"Completely eliminates supplemental metadata memory, approximately 4 times the dll size. The drawback is that full generic sharing is only supported from 2021 onwards. Enabling full generic sharing can significantly reduce package size (reducing approximately 30-40% of managed code compiled size)."),(0,i.kt)("h2",{id:"optimizing-supplemental-metadata-memory"},"Optimizing Supplemental Metadata Memory"),(0,i.kt)("p",null,"We tested the memory consumed after supplementing metadata for common aot assemblies. Community versions consume approximately 4 times the dll size; commercial versions consume about 1.3 times when full generic sharing is not enabled;\ncommercial versions consume 0 when full generic sharing is enabled since supplemental metadata is not needed. Commercial versions reduce memory by ",(0,i.kt)("strong",{parentName:"p"},"67%")," (100% when full generic sharing is enabled) compared to community versions."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Detailed Data"),":"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"aot-metadata-data",src:a(70573).Z,width:"1152",height:"589"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Memory Consumption"),":"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"aot-metadata-memory",src:a(49696).Z,width:"946",height:"481"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Memory Consumption/DLL Size"),":"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"aot-metadata-dll-rate",src:a(38744).Z,width:"921",height:"351"})),(0,i.kt)("h2",{id:"optimizing-hot-update-assembly-memory"},"Optimizing Hot Update Assembly Memory"),(0,i.kt)("p",null,"We tested the memory consumed by common plugins when loaded in interpretation mode. Community versions consume approximately 4.7 times the dll size, while commercial versions consume 2.9 times. Commercial versions reduce memory by ",(0,i.kt)("strong",{parentName:"p"},"39%")," compared to community versions."),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"This data does not include memory occupied by runtime lazy-initialized Il2CppClass, MethodInfo, and translated instructions, which accounts for approximately 2.9-3.5 times the dll size. The final metadata memory consumption is 7.6-8.2 times for community versions and 5.8-6.4 times for commercial versions.\nCommercial versions reduce memory by approximately ",(0,i.kt)("strong",{parentName:"p"},"25%")," compared to community versions.")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Detailed Data"),":"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"aot-metadata-data",src:a(36165).Z,width:"961",height:"437"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Memory Consumption"),":"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"aot-metadata-memory",src:a(84298).Z,width:"701",height:"367"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Memory Consumption/DLL Size"),":"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"aot-metadata-dll-rate",src:a(24245).Z,width:"701",height:"464"})))}d.isMDXComponent=!0},70573:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/aot-metadata-data-f950d25c4b5db38206a09b6efee0deca.jpg"},38744:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/aot-metadata-dll-rate-a45a6c8df7a58257ba4ecc5e256039f7.jpg"},49696:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/aot-metadata-memory-864c0a495fcc16076c79cc0055c99fe2.jpg"},36165:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/assembly-load-data-75401da72e0ef99c5edd902f4aa514f5.jpg"},84298:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/assembly-load-memory-0ae6d56efdaa542135024b39460b772c.jpg"},24245:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/assembly-load-rate-75c8a914ce8810c60203ec7154522545.jpg"}}]);