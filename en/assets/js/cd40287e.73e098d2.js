"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3665],{3905:(t,e,n)=>{n.d(e,{Zo:()=>s,kt:()=>y});var a=n(7294);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(t,e){if(null==t)return{};var n,a,r=function(t,e){if(null==t)return{};var n,a,r={},i=Object.keys(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var d=a.createContext({}),c=function(t){var e=a.useContext(d),n=e;return t&&(n="function"==typeof t?t(e):l(l({},e),t)),n},s=function(t){var e=c(t.components);return a.createElement(d.Provider,{value:e},t.children)},p="mdxType",u={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},m=a.forwardRef((function(t,e){var n=t.components,r=t.mdxType,i=t.originalType,d=t.parentName,s=o(t,["components","mdxType","originalType","parentName"]),p=c(n),m=r,y=p["".concat(d,".").concat(m)]||p[m]||u[m]||i;return n?a.createElement(y,l(l({ref:e},s),{},{components:n})):a.createElement(y,l({ref:e},s))}));function y(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var i=n.length,l=new Array(i);l[0]=m;var o={};for(var d in e)hasOwnProperty.call(e,d)&&(o[d]=e[d]);o.originalType=t,o[p]="string"==typeof t?t:r,l[1]=o;for(var c=2;c<i;c++)l[c]=n[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5560:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));const i={},l="Code Encryption",o={unversionedId:"business/basicencryption",id:"business/basicencryption",title:"Code Encryption",description:"The community version loads the original dll directly, forcing developers to carry and download the original dll. These original dlls can be decompiled by tools like ILSpy",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/business/basicencryption.md",sourceDirName:"business",slug:"/business/basicencryption",permalink:"/en/docs/business/basicencryption",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Offline Instruction Optimization",permalink:"/en/docs/business/basiccodeoptimization"},next:{title:"Access Control Policy",permalink:"/en/docs/business/accesspolicy"}},d={},c=[{value:"Metadata obfuscation",id:"metadata-obfuscation",level:2},{value:"Metadata encryption",id:"metadata-encryption",level:2},{value:"Custom dll file structure",id:"custom-dll-file-structure",level:3},{value:"~string stream encryption",id:"string-stream-encryption",level:3},{value:"~blob stream encryption",id:"blob-stream-encryption",level:3},{value:"~US stream encryption",id:"us-stream-encryption",level:3},{value:"~table stream encryption",id:"table-stream-encryption",level:3},{value:"method body data encryption",id:"method-body-data-encryption",level:3},{value:"Structure virtualization technology",id:"structure-virtualization-technology",level:2},{value:"Encrypted virtualization technology",id:"encrypted-virtualization-technology",level:2},{value:"Delayed decryption technology",id:"delayed-decryption-technology",level:2},{value:"Instruction virtualization technology",id:"instruction-virtualization-technology",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Encrypted hot update dll",id:"encrypted-hot-update-dll",level:2},{value:"Load hot update dll at runtime",id:"load-hot-update-dll-at-runtime",level:2}],s={toc:c},p="wrapper";function u(t){let{components:e,...n}=t;return(0,r.kt)(p,(0,a.Z)({},s,n,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"code-encryption"},"Code Encryption"),(0,r.kt)("p",null,"The community version loads the original dll directly, forcing developers to carry and download the original dll. These original dlls can be decompiled by tools like ILSpy\n, causing serious safety problems. Even if the developer encrypts it, it can easily be intercepted in the memory and obtain the decrypted dll content."),(0,r.kt)("p",null,"We provide the industry's top managed code hardening technology, which effectively prevents code from being cracked and tampered with by malicious third parties."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Technology"),(0,r.kt)("th",{parentName:"tr",align:null},"Safety Index"),(0,r.kt)("th",{parentName:"tr",align:null},"Achieved"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Metadata obfuscation"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50\u2b50"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Metadata encryption"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50\u2b50\u2b50\u2b50"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Structure Virtualization"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50\u2b50\u2b50"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Encrypted Virtualization"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50\u2b50\u2b50"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Delayed decryption"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50\u2b50\u2b50"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Instruction virtualization"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50\u2b50\u2b50\u2b50\u2b50"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714")))),(0,r.kt)("h2",{id:"metadata-obfuscation"},"Metadata obfuscation"),(0,r.kt)("p",null,"Due to clr's own mechanism, no matter how complex the encryption is, valid metadata information such as types, fields, function names, etc. can be obtained through reflection in the memory.\nThis information must be added to the security by obfuscating the metadata itself, i.e. completely losing the original plaintext information from the original level."),(0,r.kt)("p",null,"Because instruction obfuscation will significantly harm performance, only pure information types such as types, fields, and functions are obfuscated. We mainly protect code security through virtualization technology."),(0,r.kt)("h2",{id:"metadata-encryption"},"Metadata encryption"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Technology"),(0,r.kt)("th",{parentName:"tr",align:null},"Structure Virtualization"),(0,r.kt)("th",{parentName:"tr",align:null},"Encryption Virtualization"),(0,r.kt)("th",{parentName:"tr",align:null},"Lazy Decryption"),(0,r.kt)("th",{parentName:"tr",align:null},"Security Index"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Customized dll file structure"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"~string stream encryption"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50\u2b50")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"~blob stream encryption"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50\u2b50")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"~US stream encryption"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50\u2b50\u2b50")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"~table stream encryption"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50\u2b50\u2b50\u2b50")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"method body data encryption"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2714"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2b50\u2b50\u2b50")))),(0,r.kt)("h3",{id:"custom-dll-file-structure"},"Custom dll file structure"),(0,r.kt)("p",null,"The original dll file is in PE format. We changed it to a custom file structure and cannot be opened using decompilation tools such as ILSpy."),(0,r.kt)("p",null,"Supports structure virtualization technology, that is, the dll structure of each version can be completely different, which significantly increases the cost of cracking."),(0,r.kt)("h3",{id:"string-stream-encryption"},"~string stream encryption"),(0,r.kt)("p",null,"The ~string stream stores strings used internally in metadata, such as type names, field names, etc. Encrypting the ~string stream data makes it impossible to obtain the metadata string directly from the dll file."),(0,r.kt)("p",null,"Supports encryption virtualization technology, which significantly increases the difficulty of offline cracking."),(0,r.kt)("h3",{id:"blob-stream-encryption"},"~blob stream encryption"),(0,r.kt)("p",null,"~blob streams store some complex metadata (such as type signatures). Encrypting the ~blob stream makes it impossible to obtain the original lob data directly from the dll file."),(0,r.kt)("p",null,"Supports encryption virtualization technology, which significantly increases the cost of offline cracking."),(0,r.kt)("h3",{id:"us-stream-encryption"},"~US stream encryption"),(0,r.kt)("p",null,"The user string (that is, the string used in the code) metadata is saved in the ~US stream."),(0,r.kt)("p",null,"Supports encrypted virtualization technology, preventing crackers from directly obtaining original ~US metadata from dll files."),(0,r.kt)("p",null,"Supports delayed decryption to prevent crackers from using memory dump technology to directly restore all data."),(0,r.kt)("h3",{id:"table-stream-encryption"},"~table stream encryption"),(0,r.kt)("p",null,"The ~table stream holds most of the structured metadata."),(0,r.kt)("p",null,"Supporting structure virtualization technology, each version uses different metadata data structures, which greatly increases the cost of cracking. Even if it is cracked, it cannot be restored to the original ~table stream structure through simple data movement or copying."),(0,r.kt)("p",null,"Supports encrypted virtualization, which significantly increases the cost of cracking."),(0,r.kt)("p",null,"Supports delayed decryption to prevent crackers from using memory dump technology to directly restore all data."),(0,r.kt)("h3",{id:"method-body-data-encryption"},"method body data encryption"),(0,r.kt)("p",null,"The function body metadata information is stored in the method body."),(0,r.kt)("p",null,"Supports encrypted virtualization, which significantly increases the cost of cracking."),(0,r.kt)("p",null,"Supports delayed decryption to prevent crackers from using memory dump technology to directly restore all data."),(0,r.kt)("h2",{id:"structure-virtualization-technology"},"Structure virtualization technology"),(0,r.kt)("p",null,"Structure virtualization technology refers to the use of a dedicated structural virtual machine to parse the structure of metadata, and it can be dynamically adjusted without rebuilding the App. This requires the cracker to re-crack each version, which greatly increases the cost of the cracker."),(0,r.kt)("h2",{id:"encrypted-virtualization-technology"},"Encrypted virtualization technology"),(0,r.kt)("p",null,"Encrypted virtualization technology refers to the use of a dedicated encryption virtual machine to encrypt metadata, and it can be dynamically adjusted without rebuilding the app. This requires the cracker to re-crack each version, which greatly increases the cost of the cracker."),(0,r.kt)("h2",{id:"delayed-decryption-technology"},"Delayed decryption technology"),(0,r.kt)("p",null,"Delayed decryption technology refers to decrypting data only for the first time, effectively preventing crackers from hooking the critical path and directly dumping the complete original data into memory."),(0,r.kt)("h2",{id:"instruction-virtualization-technology"},"Instruction virtualization technology"),(0,r.kt)("p",null,"Instruction virtualization technology refers to converting original IL instructions into customized register virtual machine instructions, effectively preventing crackers from using ready-made decompilation tools to analyze the original code."),(0,r.kt)("p",null,"Instruction virtualization technology supports randomized instruction structures. Every time the App is rebuilt, a new instruction set is used (the instruction number and instruction length are completely different), which greatly increases the cost of crackers."),(0,r.kt)("h2",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"The encryption field in ",(0,r.kt)("inlineCode",{parentName:"p"},"HybridCLR Settings")," configures hardening related parameters."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter name"),(0,r.kt)("th",{parentName:"tr",align:null},"When encrypting dll, it needs to be consistent with the main package"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"vmSeed"),(0,r.kt)("td",{parentName:"tr",align:null},"is the"),(0,r.kt)("td",{parentName:"tr",align:null},"randomized seed for encrypted virtual machines")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"metadataSeed"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Randomized encryption seed for metadata")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"key"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Encryption parameters used for encryption and decryption")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"stringEncCodeLength"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"~The encryption instruction length of the string stream")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"blobEncCodeLength"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"~The encryption instruction length of the blob stream")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"userStringEncCodeLength"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"~US stream encryption command length")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"tableEncCodeLength"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"~Encryption instruction length of table stream")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"lazyUserStringEncCodeLength"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"~Lazy Encryption Instruction Length for US Stream")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"methdBodyEncCodeLength"),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"~Delayed encryption instruction length of the function body")))),(0,r.kt)("p",null,"vmSeed is the randomization seed for encrypted virtual machines. This random seed affects the code of the generated encrypted virtual machine and is compiled into the native code of the main package. Therefore, when generating an encrypted dll, make sure that vmSeed is consistent with the vmSeed used when packaging the main package.\nIt is recommended to modify this parameter every time a new main package is released."),(0,r.kt)("p",null,"MetadtaSeed and key are both dynamic parameters and do not need to be consistent with the main package. This value can be modified every time the encryption hot update dll is updated. It is recommended to modify these values every time or after several versions."),(0,r.kt)("p",null,"xxEncCodeLength is the length of the encryption instruction. The larger the value, the more complex the encryption. The decryption time is proportional to the length of the encryption instruction. Since the decryption process will bring some overhead, it is recommended to use the default value. if\nIt takes too long to load encrypted hot update assemblies. You can reduce these values appropriately."),(0,r.kt)("h2",{id:"encrypted-hot-update-dll"},"Encrypted hot update dll"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"HybridCLR.Editor.Encryption.EncryptUtil")," class is provided to encrypt the dll. The sample code is as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},"     public static void EncryptDll(string originalDll, string encryptedDll)\n     {\n         HybridCLR.Editor.Encryption.EncryptionUtil.EncryptDll(originalDll, encryptedDll, SettingsUtil.EncryptionSettings);\n     }\n\n")),(0,r.kt)("p",null,"For flagship version users, since the default dhao file records the MD5 value of currentDll before encryption, if the dll is encrypted, the dhao file needs to be updated synchronously, otherwise Runtime.LoadDifferentialHybridAssembly will fail to run.\nFor ease of use, we provide the ",(0,r.kt)("inlineCode",{parentName:"p"},"HybridCLR.Editor.DHE.BuildUtil.EncryptDllAndGenerateDHAODatas")," function separately to complete the encryption and generation of dhao files in one go."),(0,r.kt)("h2",{id:"load-hot-update-dll-at-runtime"},"Load hot update dll at runtime"),(0,r.kt)("p",null,"There is no difference from ordinary hot update dll, just use ",(0,r.kt)("inlineCode",{parentName:"p"},"Assembly.Load"),"."),(0,r.kt)("p",null,"Supplementary metadata dlls can also be encrypted and loaded in the same way as when unencrypted."))}u.isMDXComponent=!0}}]);