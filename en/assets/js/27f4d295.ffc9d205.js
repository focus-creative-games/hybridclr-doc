"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9695],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>f});var i=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,i,o=function(e,n){if(null==e)return{};var t,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=i.createContext({}),d=function(e){var n=i.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},p=function(e){var n=d(e.components);return i.createElement(s.Provider,{value:n},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},m=i.forwardRef((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=d(t),m=o,f=c["".concat(s,".").concat(m)]||c[m]||u[m]||r;return t?i.createElement(f,a(a({ref:n},p),{},{components:t})):i.createElement(f,a({ref:n},p))}));function f(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,a=new Array(r);a[0]=m;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[c]="string"==typeof e?e:o,a[1]=l;for(var d=2;d<r;d++)a[d]=t[d];return i.createElement.apply(null,a)}return i.createElement.apply(null,t)}m.displayName="MDXCreateElement"},65843:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var i=t(87462),o=(t(67294),t(3905));const r={},a="Modifying UnityEngine DLL",l={unversionedId:"business/reload/modifydll",id:"business/reload/modifydll",title:"Modifying UnityEngine DLL",description:"Some versions of DLLs are not compatible with hot reload and require minor code modifications.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/business/reload/modifydll.md",sourceDirName:"business/reload",slug:"/business/reload/modifydll",permalink:"/en/docs/business/reload/modifydll",draft:!1,tags:[],version:"current",frontMatter:{}},s={},d=[{value:"Using dnspy Tool",id:"using-dnspy-tool",level:2},{value:"Modifying UnityEngine.CoreModule.dll",id:"modifying-unityenginecoremoduledll",level:2}],p={toc:d},c="wrapper";function u(e){let{components:n,...t}=e;return(0,o.kt)(c,(0,i.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"modifying-unityengine-dll"},"Modifying UnityEngine DLL"),(0,o.kt)("p",null,"Some versions of DLLs are not compatible with hot reload and require minor code modifications."),(0,o.kt)("h2",{id:"using-dnspy-tool"},"Using dnspy Tool"),(0,o.kt)("p",null,"We use ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/dnSpy/dnSpy"},"dnspy")," to modify DLL files. Since dnspy can only run on Windows, even for Mac version DLLs, you need to copy the corresponding DLL to Windows first before modification. Download ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/dnSpy/dnSpy/releases"},"dnspy"),", choose the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/dnSpy/dnSpy/releases/download/v6.1.8/dnSpy-net-win64.zip"},"Win64 version"),"."),(0,o.kt)("p",null,"The general procedure for modifying DLLs is as follows:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Clear all DLLs on the left side in dnspy"),(0,o.kt)("li",{parentName:"ul"},"Open the DLL"),(0,o.kt)("li",{parentName:"ul"},"Find the function you want to modify ",(0,o.kt)("inlineCode",{parentName:"li"},"ToModifiedType.ToModifiedMethod"),", right-click menu -> Edit Method (C#)..., this opens the source code editing interface."),(0,o.kt)("li",{parentName:"ul"},"If the editor prompts that some DLL references are missing, click the folder-like button in the bottom left corner of the source code editing window to add them."),(0,o.kt)("li",{parentName:"ul"},"Modify the code"),(0,o.kt)("li",{parentName:"ul"},"Click the ",(0,o.kt)("inlineCode",{parentName:"li"},"Compile")," button in the bottom right corner. If successful, there will be no prompt, exit the editing interface and return to decompiled view mode. If it fails, please handle the compilation errors yourself. Sometimes dnspy has inexplicable reference errors; exit the source code editing mode, right-click ",(0,o.kt)("inlineCode",{parentName:"li"},"Edit Method")," again, and re-enter to resolve it."),(0,o.kt)("li",{parentName:"ul"},"Menu ",(0,o.kt)("inlineCode",{parentName:"li"},"File -> Save Module")," to save the modified DLL file. On Windows or Mac, you might encounter permission issues, please handle accordingly (such as saving to another location first, then manually overwriting)")),(0,o.kt)("h2",{id:"modifying-unityenginecoremoduledll"},"Modifying UnityEngine.CoreModule.dll"),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Only Unity 2022+ versions need modification.")),(0,o.kt)("p",null,"Unity provides a separate set of UnityEngine DLLs for each BuildTarget, located in ",(0,o.kt)("inlineCode",{parentName:"p"},"{editor_install_dir}/Editor/Data/PlaybackEngines/{platform}/Variations/il2cpp")," (for iOS platform: ",(0,o.kt)("inlineCode",{parentName:"p"},"iOSSupport\\Variations\\il2cpp\\Releasearm64_managed"),") directory. Please replace the relevant DLLs under each platform according to your packaging platform needs."),(0,o.kt)("p",null,"Since UnityEngine.CoreModule.dll references NetStandard 2.1, you need to first drag ",(0,o.kt)("inlineCode",{parentName:"p"},"Editor\\Data\\NetStandard\\ref\\2.1.0\\netstandard.dll")," into the dnspy left assembly resource manager before compilation."),(0,o.kt)("p",null,"Original code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},"namespace Unity.Collections.LowLevel.Unsafe\n{\n    // Token: 0x020000A6 RID: 166\n    internal static partial class BurstRuntime\n    {\n        // Token: 0x020000A7 RID: 167\n        private partial struct HashCode64<T>\n        {\n            // Token: 0x06000348 RID: 840 RVA: 0x000063F5 File Offset: 0x000045F5\n            // Note: this type is marked as 'beforefieldinit'.\n            static HashCode64()\n            {\n                BurstRuntime.HashCode64<T>.Value = BurstRuntime.HashStringWithFNV1A64(typeof(T).AssemblyQualifiedName);\n            }\n        }\n    }\n}\n")),(0,o.kt)("p",null,"Modified code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},"using System;\n\nnamespace Unity.Collections.LowLevel.Unsafe\n{\n    // Token: 0x020000A6 RID: 166\n    internal static partial class BurstRuntime\n    {\n        // Token: 0x020000A7 RID: 167\n        private partial struct HashCode64<T>\n        {\n            // Token: 0x06000348 RID: 840 RVA: 0x000063F5 File Offset: 0x000045F5\n            // Note: this type is marked as 'beforefieldinit'.\n            static HashCode64()\n            {\n                BurstRuntime.HashCode64<T>.Value = BurstRuntime.HashStringWithFNV1A64(typeof(T).AssemblyQualifiedName + \":\" + typeof(T).GetHashCode().ToString());\n            }\n        }\n    }\n}\n")))}u.isMDXComponent=!0}}]);