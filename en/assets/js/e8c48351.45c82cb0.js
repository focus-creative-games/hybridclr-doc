"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2896],{3905:(e,t,i)=>{i.d(t,{Zo:()=>s,kt:()=>h});var n=i(67294);function l(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function r(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?r(Object(i),!0).forEach((function(t){l(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function a(e,t){if(null==e)return{};var i,n,l=function(e,t){if(null==e)return{};var i,n,l={},r=Object.keys(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||(l[i]=e[i]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(l[i]=e[i])}return l}var p=n.createContext({}),d=function(e){var t=n.useContext(p),i=t;return e&&(i="function"==typeof e?e(t):o(o({},t),e)),i},s=function(e){var t=d(e.components);return n.createElement(p.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var i=e.components,l=e.mdxType,r=e.originalType,p=e.parentName,s=a(e,["components","mdxType","originalType","parentName"]),c=d(i),m=l,h=c["".concat(p,".").concat(m)]||c[m]||u[m]||r;return i?n.createElement(h,o(o({ref:t},s),{},{components:i})):n.createElement(h,o({ref:t},s))}));function h(e,t){var i=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=i.length,o=new Array(r);o[0]=m;var a={};for(var p in t)hasOwnProperty.call(t,p)&&(a[p]=t[p]);a.originalType=e,a[c]="string"==typeof e?e:l,o[1]=a;for(var d=2;d<r;d++)o[d]=i[d];return n.createElement.apply(null,o)}return n.createElement.apply(null,i)}m.displayName="MDXCreateElement"},47986:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>a,toc:()=>d});var n=i(87462),l=(i(67294),i(3905));const r={},o="Build Workflow",a={unversionedId:"basic/buildpipeline",id:"basic/buildpipeline",title:"Build Workflow",description:"Due to the requirements of hot updating itself and some limitations of Unity's resource management, special handling is needed for the build workflow, mainly divided into several parts:",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/basic/buildpipeline.md",sourceDirName:"basic",slug:"/basic/buildpipeline",permalink:"/en/docs/basic/buildpipeline",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Loading and Running",permalink:"/en/docs/basic/runhotupdatecodes"},next:{title:"Publishing to WebGL Platform",permalink:"/en/docs/basic/buildwebgl"}},p={},d=[{value:"Build Process",id:"build-process",level:2},{value:"Optimized Build Process",id:"optimized-build-process",level:2},{value:"Special Handling for iOS Platform",id:"special-handling-for-ios-platform",level:2},{value:"When com.code-philosophy.hybridclr version \u2265 v3.2.0",id:"when-comcode-philosophyhybridclr-version--v320",level:3},{value:"When com.code-philosophy.hybridclr version &lt; v3.2.0",id:"when-comcode-philosophyhybridclr-version--v320-1",level:3},{value:"Common Errors",id:"common-errors",level:2}],s={toc:d},c="wrapper";function u(e){let{components:t,...i}=e;return(0,l.kt)(c,(0,n.Z)({},s,i,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"build-workflow"},"Build Workflow"),(0,l.kt)("p",null,"Due to the requirements of hot updating itself and some limitations of Unity's resource management, special handling is needed for the build workflow, mainly divided into several parts:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Set UNITY_IL2CPP_PATH environment variable"),(0,l.kt)("li",{parentName:"ul"},"Automatically exclude hot update assemblies during build"),(0,l.kt)("li",{parentName:"ul"},"Add hot update dll names to assembly list during build"),(0,l.kt)("li",{parentName:"ul"},"Copy the stripped AOT dlls generated during the build process for supplemental metadata use"),(0,l.kt)("li",{parentName:"ul"},"Compile hot update dlls"),(0,l.kt)("li",{parentName:"ul"},"Generate some files and code needed for packaging"),(0,l.kt)("li",{parentName:"ul"},"Special handling for iOS platform")),(0,l.kt)("p",null,"Manual operation of these processes is tedious and error-prone. The ",(0,l.kt)("inlineCode",{parentName:"p"},"com.code-philosophy.hybridclr")," package includes standard tool scripts related to the build workflow, simplifying these complex processes into one-click operations.\nFor detailed implementation, please see the source code or ",(0,l.kt)("a",{parentName:"p",href:"/en/docs/basic/com.code-philosophy.hybridclr"},"com.code-philosophy.hybridclr introduction")),(0,l.kt)("h2",{id:"build-process"},"Build Process"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Run menu ",(0,l.kt)("inlineCode",{parentName:"li"},"HybridCLR/Generate/All")," to execute all necessary generation operations with one click"),(0,l.kt)("li",{parentName:"ol"},"Add the hot update dlls from ",(0,l.kt)("inlineCode",{parentName:"li"},"HybridCLRData/HotUpdateDlls")," to your project's hot update resource management system"),(0,l.kt)("li",{parentName:"ol"},"Add the supplemental metadata dlls from ",(0,l.kt)("inlineCode",{parentName:"li"},"HybridCLRData/AssembliesPostIl2CppStrip")," to your project's hot update resource management system"),(0,l.kt)("li",{parentName:"ol"},"Build according to your project's original packaging workflow")),(0,l.kt)("h2",{id:"optimized-build-process"},"Optimized Build Process"),(0,l.kt)("admonition",{type:"tip"},(0,l.kt)("p",{parentName:"admonition"},"Unity 2019's Android platform and HarmonyOS platform of Unity China will automatically compile libil2cpp.a during the second step of ",(0,l.kt)("inlineCode",{parentName:"p"},"exporting project"),". At this time, bridge functions and others have not been generated yet, so these platforms ",(0,l.kt)("strong",{parentName:"p"},"cannot use")," the optimized build process.")),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"HybridCLR/Generate/All")," command executes a project export during its run to generate stripped AOT dlls. This step can be very time-consuming for large projects, almost doubling the build time. If you need to optimize build time, you can follow this workflow for one-time packaging:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Run ",(0,l.kt)("inlineCode",{parentName:"li"},"HybridCLR/Generate/LinkXml")),(0,l.kt)("li",{parentName:"ul"},"Export project"),(0,l.kt)("li",{parentName:"ul"},"Run ",(0,l.kt)("inlineCode",{parentName:"li"},"HybridCLR/Generate/Il2cppDef")),(0,l.kt)("li",{parentName:"ul"},"Run ",(0,l.kt)("inlineCode",{parentName:"li"},"HybridCLR/Generate/MethodBridge")," to generate bridge functions"),(0,l.kt)("li",{parentName:"ul"},"Run ",(0,l.kt)("inlineCode",{parentName:"li"},"HybridCLR/Generate/PReverseInvokeWrapper"),". Projects that don't need to interact with lua and similar can skip this step."),(0,l.kt)("li",{parentName:"ul"},"Replace the ",(0,l.kt)("inlineCode",{parentName:"li"},"{proj}\\HybridCLRData\\LocalIl2CppData-{platform}\\il2cpp\\libil2cpp\\hybridclr\\generated")," directory with this directory in the exported project."),(0,l.kt)("li",{parentName:"ul"},"Execute build on the exported project")),(0,l.kt)("h2",{id:"special-handling-for-ios-platform"},"Special Handling for iOS Platform"),(0,l.kt)("h3",{id:"when-comcode-philosophyhybridclr-version--v320"},"When com.code-philosophy.hybridclr version ","\u2265"," v3.2.0"),(0,l.kt)("p",null,"No special handling is needed. Simply export the Xcode project and then build. Since the libil2cpp source code is added to the Xcode project only after build completion, you can only export Xcode first, then compile manually or via command line. Attempting to directly ",(0,l.kt)("inlineCode",{parentName:"p"},"Build And Run")," will cause errors."),(0,l.kt)("h3",{id:"when-comcode-philosophyhybridclr-version--v320-1"},"When com.code-philosophy.hybridclr version ","<"," v3.2.0"),(0,l.kt)("p",null,"All platforms except iOS compile the target program based on libil2cpp source code. The iOS platform uses a pre-compiled libil2cpp.a file. The Xcode project exported by Unity references a pre-generated libil2cpp.a and does not include libil2cpp source code,\nso direct packaging cannot support hot updates. Therefore, when compiling iOS programs, you need to compile libil2cpp.a separately and ",(0,l.kt)("strong",{parentName:"p"},"replace the libil2cpp.a file in the Xcode project"),", then build."),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"com.code-philosophy.hybridclr/Data~/iOSBuild")," directory contains the scripts needed to compile ",(0,l.kt)("inlineCode",{parentName:"p"},"libil2cpp.a"),". After completing the installation using ",(0,l.kt)("inlineCode",{parentName:"p"},"HybridCLR/Installer..."),", this iOSBuild directory will be copied to the ",(0,l.kt)("inlineCode",{parentName:"p"},"{project}/HybridCLRData/iOSBuild")," directory."),(0,l.kt)("p",null,"The process is as follows:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Compile ",(0,l.kt)("inlineCode",{parentName:"li"},"libil2cpp.a"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Run ",(0,l.kt)("inlineCode",{parentName:"li"},"HybridCLR/Generate/All")," to generate all necessary files"),(0,l.kt)("li",{parentName:"ul"},"Open command console and switch to the ",(0,l.kt)("inlineCode",{parentName:"li"},"{project}/HybridCLRData/iOSBuild")," directory. Please ensure the absolute path of this directory does not contain spaces! Otherwise, errors will occur."),(0,l.kt)("li",{parentName:"ul"},"bash ./build_libil2cpp.sh to compile libil2cpp.a. After completion, if you can find the libil2cpp.a file in the ",(0,l.kt)("inlineCode",{parentName:"li"},"iOSBuild/build")," directory and its size is larger than 60M, it indicates successful compilation."))),(0,l.kt)("li",{parentName:"ul"},"Replace the libil2cpp.a file in the Xcode project. Please complete this yourself.")),(0,l.kt)("h2",{id:"common-errors"},"Common Errors"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Installation not completed in ",(0,l.kt)("inlineCode",{parentName:"li"},"HybridCLR/Installer...")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"HybridCLR/Generate/All")," not executed"),(0,l.kt)("li",{parentName:"ul"},"Not using newer macOS (12 or above) and latest Xcode"),(0,l.kt)("li",{parentName:"ul"},"cmake not installed"),(0,l.kt)("li",{parentName:"ul"},"Due to git settings, the downloaded build_libil2cpp.sh and build_lump.sh contain incorrect line endings, causing script errors in the first few lines. The error message is also obvious, such as ",(0,l.kt)("inlineCode",{parentName:"li"},"/bin/bash^M file not found"),". Run command ",(0,l.kt)("inlineCode",{parentName:"li"},"cat -v build_libil2cpp.sh")," to check and confirm line ending correctness. Run ",(0,l.kt)("inlineCode",{parentName:"li"},"git config --global core.autocrlf input"),", then re-download these two script files. For details, see ",(0,l.kt)("a",{parentName:"li",href:"https://docs.github.com/cn/get-started/getting-started-with-git/configuring-git-to-handle-line-endings"},"git line ending settings"),"."),(0,l.kt)("li",{parentName:"ul"},"The absolute path of ",(0,l.kt)("inlineCode",{parentName:"li"},"{project}/HybridCLRData/iOSBuild")," contains spaces, causing gen_lump.sh script to generate incorrect results")))}u.isMDXComponent=!0}}]);