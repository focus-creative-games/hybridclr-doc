"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4675],{3905:(e,t,a)=>{a.d(t,{Zo:()=>m,kt:()=>g});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var d=n.createContext({}),p=function(e){var t=n.useContext(d),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},m=function(e){var t=p(e.components);return n.createElement(d.Provider,{value:t},e.children)},s="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,l=e.originalType,d=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),s=p(a),c=i,g=s["".concat(d,".").concat(c)]||s[c]||u[c]||l;return a?n.createElement(g,r(r({ref:t},m),{},{components:a})):n.createElement(g,r({ref:t},m))}));function g(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var l=a.length,r=new Array(l);r[0]=c;var o={};for(var d in t)hasOwnProperty.call(t,d)&&(o[d]=t[d]);o.originalType=e,o[s]="string"==typeof e?e:i,r[1]=o;for(var p=2;p<l;p++)r[p]=a[p];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},19539:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>u,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var n=a(87462),i=(a(67294),a(3905));const l={},r="Impact on App Package Size",o={unversionedId:"basic/impactonappsize",id:"basic/impactonappsize",title:"Impact on App Package Size",description:"The impact on package size after integrating HybridCLR mainly consists of the following parts:",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/basic/impactonappsize.md",sourceDirName:"basic",slug:"/basic/impactonappsize",permalink:"/en/docs/basic/impactonappsize",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Execution Performance",permalink:"/en/docs/basic/performance"},next:{title:"Impact on App Memory",permalink:"/en/docs/basic/impactonappmemory"}},d={},p=[{value:"Testing",id:"testing",level:2},{value:"Summary",id:"summary",level:2},{value:"Community Edition, Professional Edition, Hot Reload Edition",id:"community-edition-professional-edition-hot-reload-edition",level:3},{value:"Ultimate Edition",id:"ultimate-edition",level:3}],m={toc:p},s="wrapper";function u(e){let{components:t,...a}=e;return(0,i.kt)(s,(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"impact-on-app-package-size"},"Impact on App Package Size"),(0,i.kt)("p",null,"The impact on package size after integrating HybridCLR mainly consists of the following parts:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"HybridCLR main code excluding MethodBridge.cpp"),(0,i.kt)("li",{parentName:"ol"},"Bridge function file MethodBridge.cpp code"),(0,i.kt)("li",{parentName:"ol"},"C++ code generated by il2cpp translating HybridCLR.Runtime.dll code"),(0,i.kt)("li",{parentName:"ol"},"Reduced binary code size after changing AOT assemblies to interpreted execution")),(0,i.kt)("p",null,"Among these, part 1 has less than 30,000 lines of code, part 3 has less than 2,000 lines of code, and their impact on the final package size is minimal. MethodBridge.cpp is generated based on calculations from AOT assemblies. Generally speaking, the more code in AOT assemblies, the larger the MethodBridge.cpp file will be. Typically, depending on the complexity of the project's AOT modules, the MethodBridge.cpp file size ranges from 2M-40M."),(0,i.kt)("p",null,"We built test projects to test the actual impact of HybridCLR on package size."),(0,i.kt)("h2",{id:"testing"},"Testing"),(0,i.kt)("p",null,"We tested the size of Android Armv8 platform apk built in Unity 2021."),(0,i.kt)("p",null,"The AOT part of the test project completely includes the following frameworks and libraries:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"mscorlib, System, System.Core"),(0,i.kt)("li",{parentName:"ul"},"UnityEngine.dll, UnityEngine.CoreModule.dll, UnityEngine.UI.dll, UnityEngine.PhysicsModule.dll"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/EllanJiang/GameFramework"},"GameFramework framework")),(0,i.kt)("li",{parentName:"ul"},"HybridCLR.Runtime.dll"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/focus-creative-games/luban"},"Luban")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/Cysharp/UniTask"},"UniTask")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/tuyoogame/YooAsset"},"YooAsset"))),(0,i.kt)("p",null,"We counted the total size of AOT module dlls after building the apk: 12.0M in total."),(0,i.kt)("p",null,"The hot update part of the test project consists of the following components:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Unit test project code"),(0,i.kt)("li",{parentName:"ul"},"Configuration code generated by Luban")),(0,i.kt)("p",null,"The compiled HotUpdate.dll is 1216k. For fairness, projects integrating HybridCLR will compress the hot update dll and place it in StreamingAssets for packaging."),(0,i.kt)("p",null,"We compared the package sizes for the following 8 scenarios:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"NotHybridCLR-NotHotUpdateCode: No HybridCLR integration, no HotUpdate code included (i.e., HotUpdate not included in AOT)"),(0,i.kt)("li",{parentName:"ul"},"HybridCLR-NotHotUpdateCode-NotMethodBridge: HybridCLR integrated, no HotUpdate code included, bridge function file is empty"),(0,i.kt)("li",{parentName:"ul"},"HybridCLR-NotHotUpdateCode-MethodBridge: HybridCLR integrated, no HotUpdate code included, bridge function file normally generated"),(0,i.kt)("li",{parentName:"ul"},"NotHybridCLR-HotUpdateCode: No HybridCLR integration, HotUpdate code included (i.e., HotUpdate included in AOT)"),(0,i.kt)("li",{parentName:"ul"},"HybridCLR-HotUpdateCode-NotMethodBridge: HybridCLR integrated, HotUpdate code included (HotUpdate.dll compressed and placed in StreamingAssets for packaging), bridge function file is empty"),(0,i.kt)("li",{parentName:"ul"},"HybridCLR-HotUpdateCode-MethodBridge: HybridCLR integrated, HotUpdate code included, bridge function file normally generated"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"HybridCLR Ultimate Edition"),"-NotHotUpdateCode-MethodBridge: Ultimate Edition HybridCLR integrated, no HotUpdate code included, bridge function normally generated"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"HybridCLR Ultimate Edition"),"-HotUpdateCode-MethodBridge: Ultimate Edition HybridCLR integrated, HotUpdate code included, bridge function normally generated")),(0,i.kt)("p",null,"Test data is as follows:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Build Method"),(0,i.kt)("th",{parentName:"tr",align:null},"Apk Size (K)"),(0,i.kt)("th",{parentName:"tr",align:null},"global-metadata.dat (uncompressed)"),(0,i.kt)("th",{parentName:"tr",align:null},"global-metadata.dat (compressed)"),(0,i.kt)("th",{parentName:"tr",align:null},"libil2cpp.so (uncompressed)"),(0,i.kt)("th",{parentName:"tr",align:null},"libil2cpp.so (compressed)"),(0,i.kt)("th",{parentName:"tr",align:null},"HotUpdate.dll Size (uncompressed) (K)"),(0,i.kt)("th",{parentName:"tr",align:null},"MethodBridge.cpp Size (K)"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"NotHybridCLR-NotHotUpdateCode"),(0,i.kt)("td",{parentName:"tr",align:null},"30066"),(0,i.kt)("td",{parentName:"tr",align:null},"10087740"),(0,i.kt)("td",{parentName:"tr",align:null},"2980934"),(0,i.kt)("td",{parentName:"tr",align:null},"73383680"),(0,i.kt)("td",{parentName:"tr",align:null},"18954786"),(0,i.kt)("td",{parentName:"tr",align:null},"0"),(0,i.kt)("td",{parentName:"tr",align:null},"0")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"HybridCLR-NotHotUpdateCode-NotMethodBridge"),(0,i.kt)("td",{parentName:"tr",align:null},"30262"),(0,i.kt)("td",{parentName:"tr",align:null},"10075360"),(0,i.kt)("td",{parentName:"tr",align:null},"2904652"),(0,i.kt)("td",{parentName:"tr",align:null},"74026488"),(0,i.kt)("td",{parentName:"tr",align:null},"19158769"),(0,i.kt)("td",{parentName:"tr",align:null},"0"),(0,i.kt)("td",{parentName:"tr",align:null},"0")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"HybridCLR-NotHotUpdateCode-MethodBridge"),(0,i.kt)("td",{parentName:"tr",align:null},"30900"),(0,i.kt)("td",{parentName:"tr",align:null},"10075360"),(0,i.kt)("td",{parentName:"tr",align:null},"2904652"),(0,i.kt)("td",{parentName:"tr",align:null},"78450168"),(0,i.kt)("td",{parentName:"tr",align:null},"19905020"),(0,i.kt)("td",{parentName:"tr",align:null},"0"),(0,i.kt)("td",{parentName:"tr",align:null},"15082")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"NotHybridCLR-HotUpdateCode"),(0,i.kt)("td",{parentName:"tr",align:null},"31718"),(0,i.kt)("td",{parentName:"tr",align:null},"10893056"),(0,i.kt)("td",{parentName:"tr",align:null},"3103289"),(0,i.kt)("td",{parentName:"tr",align:null},"79670208"),(0,i.kt)("td",{parentName:"tr",align:null},"20387018"),(0,i.kt)("td",{parentName:"tr",align:null},"1206"),(0,i.kt)("td",{parentName:"tr",align:null},"0")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"HybridCLR-HotUpdateCode-NotMethodBridge"),(0,i.kt)("td",{parentName:"tr",align:null},"30531"),(0,i.kt)("td",{parentName:"tr",align:null},"10081232"),(0,i.kt)("td",{parentName:"tr",align:null},"2906522"),(0,i.kt)("td",{parentName:"tr",align:null},"74158928"),(0,i.kt)("td",{parentName:"tr",align:null},"19177165"),(0,i.kt)("td",{parentName:"tr",align:null},"1206"),(0,i.kt)("td",{parentName:"tr",align:null},"0")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"HybridCLR-HotUpdateCode-MethodBridge"),(0,i.kt)("td",{parentName:"tr",align:null},"31259"),(0,i.kt)("td",{parentName:"tr",align:null},"10081232"),(0,i.kt)("td",{parentName:"tr",align:null},"2906522"),(0,i.kt)("td",{parentName:"tr",align:null},"78492496"),(0,i.kt)("td",{parentName:"tr",align:null},"19920506"),(0,i.kt)("td",{parentName:"tr",align:null},"1206"),(0,i.kt)("td",{parentName:"tr",align:null},"14861")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},"HybridCLR Ultimate Edition"),"-NotUserCode-MethodBridge"),(0,i.kt)("td",{parentName:"tr",align:null},"31022"),(0,i.kt)("td",{parentName:"tr",align:null},"10078796"),(0,i.kt)("td",{parentName:"tr",align:null},"2905605"),(0,i.kt)("td",{parentName:"tr",align:null},"78643792"),(0,i.kt)("td",{parentName:"tr",align:null},"19935716"),(0,i.kt)("td",{parentName:"tr",align:null},"0"),(0,i.kt)("td",{parentName:"tr",align:null},"14837")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},"HybridCLR Ultimate Edition"),"-UserCode-MethodBridge"),(0,i.kt)("td",{parentName:"tr",align:null},"32910"),(0,i.kt)("td",{parentName:"tr",align:null},"10893080"),(0,i.kt)("td",{parentName:"tr",align:null},"3103310"),(0,i.kt)("td",{parentName:"tr",align:null},"85964616"),(0,i.kt)("td",{parentName:"tr",align:null},"21622297"),(0,i.kt)("td",{parentName:"tr",align:null},"1206"),(0,i.kt)("td",{parentName:"tr",align:null},"15179")))),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("inlineCode",{parentName:"p"},"Uncompressed")," refers to the original size of the file in the apk, ",(0,i.kt)("inlineCode",{parentName:"p"},"Compressed")," refers to the compressed size of the file in the apk")),(0,i.kt)("p",null,"The original size of the hot update code HotUpdate.dll is 1216k, compressed to 200k."),(0,i.kt)("p",null,"Based on the above test project, we can roughly draw the following conclusions:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The main part of HybridCLR excluding MethodBridge.cpp ultimately increased package size by 196k"),(0,i.kt)("li",{parentName:"ul"},"Bridge function files increased package size by approximately ",(0,i.kt)("inlineCode",{parentName:"li"},"{MethodBridge.cpp size} * 0.049")),(0,i.kt)("li",{parentName:"ul"},"For each new game code of size S, for apps without HybridCLR integration, package size increased by ",(0,i.kt)("inlineCode",{parentName:"li"},"S * 1.37")),(0,i.kt)("li",{parentName:"ul"},"For each new game code of size S, for apps with HybridCLR integration, package size increased by ",(0,i.kt)("inlineCode",{parentName:"li"},"S * 0.2")),(0,i.kt)("li",{parentName:"ul"},"For each new game code of size S, Ultimate Edition increased package size by ",(0,i.kt)("inlineCode",{parentName:"li"},"S * 1.56")),(0,i.kt)("li",{parentName:"ul"},"When no update assemblies are included, Ultimate Edition increases package size by 32K compared to community edition")),(0,i.kt)("h2",{id:"summary"},"Summary"),(0,i.kt)("h3",{id:"community-edition-professional-edition-hot-reload-edition"},"Community Edition, Professional Edition, Hot Reload Edition"),(0,i.kt)("p",null,"Integrating HybridCLR increases package size by ",(0,i.kt)("inlineCode",{parentName:"p"},"196k + {MethodBridge.cpp size}*0.049"),", but moving game code from AOT to hot update can reduce package size by ",(0,i.kt)("inlineCode",{parentName:"p"},"{hot update dll size}*1.17")," times."),(0,i.kt)("p",null,"This means that if a project's hot update code exceeds 800K-1500K, the final package size after integrating HybridCLR will be smaller than without HybridCLR integration. The final package reduction can be roughly approximated using ",(0,i.kt)("inlineCode",{parentName:"p"},"hot update dll size*1.05"),"."),(0,i.kt)("h3",{id:"ultimate-edition"},"Ultimate Edition"),(0,i.kt)("p",null,"Integrating HybridCLR increases package size by ",(0,i.kt)("inlineCode",{parentName:"p"},"228k + {MethodBridge.cpp size}*0.049"),". New code in DHE assemblies will cause an increase in package size of ",(0,i.kt)("inlineCode",{parentName:"p"},"{new DHE assembly size}*1.56"),".\nMoving game code from AOT to DHE assemblies will increase package size by ",(0,i.kt)("inlineCode",{parentName:"p"},"{new DHE assembly size}*0.19"),"."))}u.isMDXComponent=!0}}]);