<!doctype html>
<html lang="en-us" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-basic/aotgeneric">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">AOT generic problem | HybridCLR</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hybridclr.doc.code-philosophy.com/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hybridclr.doc.code-philosophy.com/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hybridclr.doc.code-philosophy.com/en/docs/basic/aotgeneric"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="AOT generic problem | HybridCLR"><meta data-rh="true" name="description" content="There are two types of generic features in the CLR: generic types and generic functions. Generics are an extremely widely used feature in C#. Even a usage that does not explicitly contain generics may imply generic-related definitions or operations."><meta data-rh="true" property="og:description" content="There are two types of generic features in the CLR: generic types and generic functions. Generics are an extremely widely used feature in C#. Even a usage that does not explicitly contain generics may imply generic-related definitions or operations."><link data-rh="true" rel="icon" href="/en/img/logo.png"><link data-rh="true" rel="canonical" href="https://hybridclr.doc.code-philosophy.com/en/docs/basic/aotgeneric"><link data-rh="true" rel="alternate" href="https://hybridclr.doc.code-philosophy.com/docs/basic/aotgeneric" hreflang="zh-cn"><link data-rh="true" rel="alternate" href="https://hybridclr.doc.code-philosophy.com/en/docs/basic/aotgeneric" hreflang="en-us"><link data-rh="true" rel="alternate" href="https://hybridclr.doc.code-philosophy.com/docs/basic/aotgeneric" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://MHX0T95QPO-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/en/blog/rss.xml" title="HybridCLR RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/blog/atom.xml" title="HybridCLR Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="HybridCLR" href="/en/opensearch.xml"><link rel="stylesheet" href="/en/assets/css/styles.d6735dd1.css">
<link rel="preload" href="/en/assets/js/runtime~main.ac8000ae.js" as="script">
<link rel="preload" href="/en/assets/js/main.c0ac5868.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/logo.png" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/en/img/logo.png" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">HybridCLR</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/en/docs/intro">Tutorial</a><a class="navbar__item navbar__link" href="/en/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/focus-creative-games/hybridclr" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/basic/aotgeneric" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-cn">中文</a></li><li><a href="/en/docs/basic/aotgeneric" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-us">English</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/en/docs/beginner">Beginner Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Beginner Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/beginner/quickstart">Getting started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/beginner/monobehaviour">Use MonoBehaviour</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/beginner/generic">Use Generics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/beginner/otherhelp">Other Information</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/en/docs/basic">Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/basic/supportedplatformanduniyversion">Supported Unity versions and platforms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/basic/architecture">HybridCLR code structure and version</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/basic/install">Install HybridCLR</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/basic/projectsettings">Configure HybridCLR</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/basic/hotupdateassemblysetting">Create and configure hot update assembly</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/basic/runhotupdatecodes">Load and use hot update code</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/basic/buildpipeline">HybridCLR building workflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/basic/buildwebgl">Publish the WebGL platform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/basic/codestriping">Code clipping problem</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/basic/monobehaviour">Use MonoBehaviour</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/en/docs/basic/aotgeneric">AOT generic problem</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/basic/methodbridge">AOT-interpreter bridge function</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/basic/memory">Memory and GC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/basic/performance">Execution performance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/basic/differentialhybridexecution">Differential Hybrid Execution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/basic/notsupportedfeatures">Unsupported features</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/basic/com.code-philosophy.hybridclr">com.code-philosophy.hybridclr</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/basic/bestpractice">Best Practices</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/basic/migratefromnetstandard">Migrate projects whose Api Level is netstandard</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/basic/workwithscriptlanguage">HybridCLR+lua/js/python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/basic/sourceinspect">HybridCLR source code structure and debugging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/basic/il2cppbugs">il2cpp bug log</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/business">Business Edition</a><button aria-label="Toggle the collapsible sidebar category &#x27;Business Edition&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/help">Help</a><button aria-label="Toggle the collapsible sidebar category &#x27;Help&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/other">Others</a><button aria-label="Toggle the collapsible sidebar category &#x27;Others&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/en/docs/basic"><span itemprop="name">Guides</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">AOT generic problem</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>AOT generic problem</h1><p>There are two types of generic features in the CLR: generic types and generic functions. Generics are an extremely widely used feature in C#. Even a usage that does not explicitly contain generics may imply generic-related definitions or operations.</p><p>For the generic class defined in <strong>hot update code, you can use it freely without restrictions, but for </strong>AOT generics**, you have encountered some problems.</p><p>il2cpp is an AOT runtime, and almost all (why not all?) types used in its runtime are statically determined at compile time. You have only instantiated <code>List&lt;int&gt;</code> and <code>List&lt;string&gt;</code> in AOT, you can use <code>new List&lt;int&gt;()</code> in hot update code
, but cannot use <code>new List&lt;float&gt;()</code>. Because although il2cpp can create most of the metadata of the <code>List&lt;float&gt;</code> type in memory, it cannot create its member function implementations.
For example, you can get <code>typeof(List&lt;float&gt;)</code> through reflection, but you cannot call any of its member functions, including constructors.</p><p>Generic classes, especially generic containers such as List and Dictionary are widely used in code. If <code>List&lt;HotUpdateType&gt;</code> cannot run due to AOT restrictions, then the code restriction for game hot update is also too large up. Fortunately, HybridCLR solves this problem completely using two types of techniques:</p><ul><li><code>Generic sharing</code> technology based on il2cpp</li><li>Based on <code>Supplementary Metadata</code> technology, which is also HybridCLR&#x27;s patented technology</li></ul><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>Since the il2cpp generic sharing technology has great limitations, it is strongly recommended to use the <code>supplementary metadata</code> technology to solve the generic problem.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="generic-sharing-mechanism-of-il2cpp">Generic sharing mechanism of il2cpp<a href="#generic-sharing-mechanism-of-il2cpp" class="hash-link" aria-label="Direct link to Generic sharing mechanism of il2cpp" title="Direct link to Generic sharing mechanism of il2cpp">​</a></h2><p>In order to avoid generic code expansion and save memory, il2cpp generates only one code for some codes that can be shared while ensuring the correctness of code logic. To introduce a concept called <strong>generic code sharing</strong> <a href="https://blog.unity.com/technology/il2cpp-internals-generic-sharing-implementation" target="_blank" rel="noopener noreferrer">Generic Sharing</a>.
Generic function implementations whose generic parameters are of class type can be shared. For example, the code compiled for the List<!-- -->&lt;<!-- -->String<!-- -->&gt;<!-- --> method can be directly used for the List<!-- -->&lt;<!-- -->Stream<!-- -->&gt;<!-- --> method, but the generic parameter of the value type cannot be shared.</p><p>  Take List<!-- -->&lt;<!-- -->T<!-- -->&gt;<!-- --> as an example:</p><ul><li>You can use any instantiation type of List used in AOT. For example, if you have used List<!-- -->&lt;<!-- -->vector3<!-- -->&gt;<!-- --> in AOT, you can also use it in hot update</li><li>Any List<!-- -->&lt;<!-- -->HotUpdateEnum<!-- -->&gt;<!-- --> can be used. You only need to instantiate a certain List<!-- -->&lt;<!-- -->enumeration type of the same underlying type<!-- -->&gt;<!-- --> in AOT.</li><li>The generic parameter List<!-- -->&lt;<!-- -->HotUpdateClass<!-- -->&gt;<!-- --> of any reference type can be used. You only need to instantiate List<!-- -->&lt;<!-- -->object<!-- -->&gt;<!-- --> (or any reference generic parameter such as List<!-- -->&lt;<!-- -->string<!-- -->&gt;<!-- -->) in AOT</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="shared-type-calculation-rules">Shared type calculation rules<a href="#shared-type-calculation-rules" class="hash-link" aria-label="Direct link to Shared type calculation rules" title="Direct link to Shared type calculation rules">​</a></h2><p>Assuming that the shared type of the generic class T is sharing type, the calculation rules are as follows.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="non-enumeration-value-types">Non-enumeration value types<a href="#non-enumeration-value-types" class="hash-link" aria-label="Direct link to Non-enumeration value types" title="Direct link to Non-enumeration value types">​</a></h3><p>The sharing type is itself. For example, the sharing type of int is int</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="enum-type">Enum Type<a href="#enum-type" class="hash-link" aria-label="Direct link to Enum Type" title="Direct link to Enum Type">​</a></h3><p>The sharing type is an enumeration whose underlying type is the same as it. For example</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token class-name">MyEnumA</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     A </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token class-name">MyEnumB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     A </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token class-name">MyEnumC</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token type-list keyword" style="color:#00009f">short</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     A </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token class-name">MyEnumD</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token type-list keyword" style="color:#00009f">short</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     A </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>MyEnumA and MyEnumB sharing the same type, and MyEnumC and MyEnumD sharing the same type.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="class-reference-type">class reference type<a href="#class-reference-type" class="hash-link" aria-label="Direct link to class reference type" title="Direct link to class reference type">​</a></h3><p>sharing type is object</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="generic-types">Generic Types<a href="#generic-types" class="hash-link" aria-label="Direct link to Generic Types" title="Direct link to Generic Types">​</a></h3><p>For <code>GenericType&lt;T1, T2, ...&gt;</code>, if the GenericType is a class type, then the sharing type is object, otherwise the sharing type is <code>GenericType&lt;shareType&lt;T1&gt;, shareType&lt;T2&gt;, ...&gt;</code>. For example:</p><ul><li>The sharing type of <code>Dictionary&lt;int, string&gt;</code> is <code>object</code></li><li>The sharing type of <code>ValueTuple&lt;int, string&gt;</code> is <code>ValueTuple&lt;int, object&gt;</code></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="shared-generic-function-evaluation-rules-for-generic-functions">Shared generic function evaluation rules for generic functions<a href="#shared-generic-function-evaluation-rules-for-generic-functions" class="hash-link" aria-label="Direct link to Shared generic function evaluation rules for generic functions" title="Direct link to Shared generic function evaluation rules for generic functions">​</a></h3><p>The AOT generic function of <code>Class&lt;C1, C2, ...&gt;.Method&lt;M1, M2, ...&gt;(A1, A2, ...)</code> is <code>Class&lt;sharing(C1), sharing(C2) , ...&gt;.Method&lt;sharing(M1), sharing(M2), ...&gt;(sharing(A1), sharing(A2), ...)</code>. For example:</p><ul><li>Shared function of <code>List&lt;string&gt;.ctor</code> is <code>List&lt;object&gt;.ctor</code></li><li>The shared function of <code>List&lt;int&gt;.Add(int)</code> is <code>List&lt;int&gt;.Add(int)</code></li><li>The shared function of <code>YourGenericClass&lt;string, int, List&lt;int&gt;&gt;.Show&lt;string, List&lt;int&gt;, int&gt;(ValueTuple&lt;int, string&gt;, string, int)</code> is <code>YourGenericClass&lt;object, int, object &gt;.Show&lt;object, object, int&gt;(ValueTuple&lt;int, object&gt;, object, int)</code></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-reason-why-the-value-type-in-il2cpp-does-not-support-generic-sharing">The reason why the value type in il2cpp does not support generic sharing<a href="#the-reason-why-the-value-type-in-il2cpp-does-not-support-generic-sharing" class="hash-link" aria-label="Direct link to The reason why the value type in il2cpp does not support generic sharing" title="Direct link to The reason why the value type in il2cpp does not support generic sharing">​</a></h2><p>It is easy to understand that value types of different sizes cannot be shared, but why can&#x27;t value types of the same size be shared generically like a class? There are two main reasons.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="problems-caused-by-memory-alignment">Problems caused by memory alignment<a href="#problems-caused-by-memory-alignment" class="hash-link" aria-label="Direct link to Problems caused by memory alignment" title="Direct link to Problems caused by memory alignment">​</a></h3><p>Even if the value types have the same size, if the alignment is different, when they are used as subfields of other classes, the memory size and layout of the final class may be different.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">A</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// size = 4, alignment = 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token class-name keyword" style="color:#00009f">short</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token class-name keyword" style="color:#00009f">short</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">B</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// size = 4, alignment = 4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token class-name keyword" style="color:#00009f">int</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">GenericDemo</span><span class="token class-name punctuation" style="color:#393A34">&lt;</span><span class="token class-name">T</span><span class="token class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token class-name keyword" style="color:#00009f">short</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token class-name">T</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name">T</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>GenericDemo&lt;A&gt;</code> size=6, alignment=2, field v is offset by 2 in the class; and <code>GenericDemo&lt;B&gt;</code> size=8, alignment=4, field v is offset by 4 in the class. Obviously, for the GetValue function, due to the different offsets of v, it is impossible to use the same set of c++ codes to work correctly for these two classes.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="abi-issues">ABI issues<a href="#abi-issues" class="hash-link" aria-label="Direct link to ABI issues" title="Direct link to ABI issues">​</a></h3><p>Structures of the same size and alignment are equivalent in <a href="https://docs.microsoft.com/zh-cn/cpp/build/x64-software-conventions?redirectedfrom=MSDN&amp;view=msvc-170" target="_blank" rel="noopener noreferrer">x64 ABI</a> , you can use structures of the same size for shared generic instantiation. But it doesn&#x27;t work in <a href="https://docs.microsoft.com/zh-cn/cpp/build/arm64-windows-abi-conventions?view=msvc-170" target="_blank" rel="noopener noreferrer">arm64 ABI</a>.</p><p><code>struct IntVec3 { int32_t x, y, z; }</code> and <code>struct FloatVec3 { float x, y, z}</code> are both 12 in size, but when they are passed as function parameters, the way of passing parameters is different:</p><ul><li>IntVec3 is passed by reference</li><li>The three fields of FloatVec3 are placed in three floating-point registers respectively</li></ul><p>This is another key reason why structs cannot be shared generically.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="defects-of-the-generic-sharing-mechanism">Defects of the generic sharing mechanism<a href="#defects-of-the-generic-sharing-mechanism" class="hash-link" aria-label="Direct link to Defects of the generic sharing mechanism" title="Direct link to Defects of the generic sharing mechanism">​</a></h2><p>Since value types cannot be shared generically, if a value type appears in the generic parameter of a generic instance (class or function), this generic instance must be instantiated in advance in AOT. if
Your generic parameter type is the value type defined in the hot update code. Since the hot update type is obviously impossible to instantiate generics in AOT in advance, you are hot updating the code
Codes such as <code>List&lt;hot update value type&gt;</code> cannot be used in , which brings great inconvenience to development.</p><p>Fortunately, we innovatively proposed the patented technology of <code>Supplementary Metadata</code>, which completely solved this problem.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="generic-function-instantiation-technology-based-on-supplementary-metadata-hybridclrs-patented-technology">Generic function instantiation technology based on supplementary metadata (HybridCLR&#x27;s patented technology)<a href="#generic-function-instantiation-technology-based-on-supplementary-metadata-hybridclrs-patented-technology" class="hash-link" aria-label="Direct link to Generic function instantiation technology based on supplementary metadata (HybridCLR&#x27;s patented technology)" title="Direct link to Generic function instantiation technology based on supplementary metadata (HybridCLR&#x27;s patented technology)">​</a></h2><p>All metadata except functions in AOT generic metadata can be instantiated in memory through the Inflate technology, but functions cannot be instantiated. The problem that AOT generic functions cannot be instantiated is essentially because il2cpp loses the original function body IL metadata during the translation of <code>IL -&gt; C++</code>.
Take the <code>List&lt;T&gt;.Add</code> function as an example, if there is no original IL function information, the correct <code>List&lt;long The implementation of &gt;.Add</code>. Our solution is very ingenious - to supplement the lost metadata of the original generic function body.</p><p>Use the <code>HybridCLR.RuntimeApi.LoadMetadataForAOTAssembly</code> function in the com.code-philosophy.hybridclr package to supplement the corresponding metadata for the AOT assembly.
The LoadMetadataForAOTAssembly function can be called at any time. In addition, it can be called in AOT or hot update. You just need to call it before using AOT generics (only need to call it once).
In theory, the earlier the loading, the better. In practice, the more reasonable time is after the hot update is completed, or after the hot update dll is loaded but before any code is executed. If the dll that supplements the metadata is also entered into the main package as an additional data file (for example, put it under StreamingAssets), it will be better loaded when the main project starts.</p><p><strong>Supplementary metadata has no load order requirement</strong>.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>It is the generic function that loses the IL function body metadata, not the generic parameter type that loses metadata. Take <code>List&lt;YourValueType&gt;.Add</code> as an example,
It is the <code>List&lt;T&gt;.Add</code> function that is missing raw IL function body metadata, not <code>YourValueType</code> that is missing metadata, so
The metadata of the aot dll where the generic class resides should be supplemented. For example, in order to use <code>List&lt;Vector3&gt;</code>, you should supplement the metadata of the dll where <code>List&lt;T&gt;</code> resides (namely <code>mscorlib</code>), instead of supplementing the metadata of the dll where <code>YourValueType</code> resides.</p></div></div><p>If the AOT generic supplements the corresponding generic metadata, and il2cpp generic sharing instantiation also exists, in order to maximize performance, HybridCLR will give priority to il2cpp generic sharing.</p><p>Although the generic function instantiation technology based on supplementary metadata is quite perfect, after all, the instantiated function is executed in an interpreted manner. If the generic instantiation in AOT can be performed in advance, the performance can be greatly improved.
Therefore, generic classes and functions that are commonly used, especially performance-sensitive, can be instantiated in AOT in advance. We provide tools to help automatically scan and collect corresponding generic instances, you can run the menu command <code>HybridCLR/Generate/AOTGenericReference</code>.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>This command only collects the AOT generic instances used in the hot update, and all generated are in the form of annotations. You need to refer to this file yourself and explicitly instantiate some generics in other places according to actual needs.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="get-supplementary-metadata-dll">Get Supplementary Metadata dll<a href="#get-supplementary-metadata-dll" class="hash-link" aria-label="Direct link to Get Supplementary Metadata dll" title="Direct link to Get Supplementary Metadata dll">​</a></h3><p>The clipped AOT dll generated by <strong>packaging process</strong> can be used to supplement metadata. The com.code-philosophy.hybridclr plugin will automatically copy them to <code>{project}/HybridCLRData/AssembliesPostIl2CppStrip/{target}</code>. Note that tailoring AOT dlls of different BuildTargets cannot be reused.</p><p>Using the <code>HybridCLR/Generate/AotDlls</code> command can also generate the trimmed AOT dll immediately, it works by exporting a Temp project to get the trimmed AOT dll.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="should-make-up">should make up<a href="#should-make-up" class="hash-link" aria-label="Direct link to should make up" title="Direct link to should make up">​</a></h3><p>A list of assemblies filled with metadata</p><p>The <code>AOTGenericReferences.cs</code> file generated by the <code>HybridCLR/generate/AOTGenericReference</code> command contains a list of assemblies that should be supplemented with metadata, like this. You don&#x27;t need to run the game to quickly know which metadata should be added.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// {{ AOT assemblies</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Main.dll</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// System. Core. dll</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// UnityEngine.CoreModule.dll</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// mscorlib.dll</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// }}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="metadata-mode-homologousimagemode">Metadata Mode HomologousImageMode<a href="#metadata-mode-homologousimagemode" class="hash-link" aria-label="Direct link to Metadata Mode HomologousImageMode" title="Direct link to Metadata Mode HomologousImageMode">​</a></h3><p>Two metadata schemas are currently supported:</p><ul><li><code>HomologousImageMode::Consistent</code> mode, that is, the supplementary dll is exactly the same as the cropped dll when packaging. Therefore, the clipped dll generated during the build process must be used, and the original dll cannot be copied directly.</li><li><code>HomologousImageMode::SuperSet</code> mode, that is, the supplementary dll is a superset of the cropped dll when packaging. This mode relaxes the requirements for AOT dll, you can use either the cut AOT dll or the original AOT dll.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="load-supplementary-metadata-sample-code">Load supplementary metadata sample code<a href="#load-supplementary-metadata-sample-code" class="hash-link" aria-label="Direct link to Load supplementary metadata sample code" title="Direct link to Load supplementary metadata sample code">​</a></h3><p>See the sample code below for how to load the supplementary metadata dll in the code, and you can also refer to <a href="https://github.com/focus-creative-games/hybridclr_trial" target="_blank" rel="noopener noreferrer">hybridclr_trial</a>.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">unsafe</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">LoadMetadataForAOTAssembly</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token class-name">List</span><span class="token class-name punctuation" style="color:#393A34">&lt;</span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> aotDllList </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">List</span><span class="token constructor-invocation class-name punctuation" style="color:#393A34">&lt;</span><span class="token constructor-invocation class-name keyword" style="color:#00009f">string</span><span class="token constructor-invocation class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token string" style="color:#e3116c">&quot;mscorlib.dll&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token string" style="color:#e3116c">&quot;System.dll&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token string" style="color:#e3116c">&quot;System.Core.dll&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// required if using Linq</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic">// &quot;Newtonsoft.Json.dll&quot;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic">// &quot;protobuf-net.dll&quot;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token class-name">AssetBundle</span><span class="token plain"> dllAB </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> LoadDll</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> AssemblyAssetBundle</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token keyword" style="color:#00009f">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> aotDllName </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> aotDllList</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token class-name keyword" style="color:#00009f">byte</span><span class="token class-name punctuation" style="color:#393A34">[</span><span class="token class-name punctuation" style="color:#393A34">]</span><span class="token plain"> dllBytes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dllAB</span><span class="token punctuation" style="color:#393A34">.</span><span class="token generic-method function" style="color:#d73a49">LoadAsset</span><span class="token generic-method generic class-name punctuation" style="color:#393A34">&lt;</span><span class="token generic-method generic class-name">TextAsset</span><span class="token generic-method generic class-name punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">aotDllName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bytes</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token class-name keyword" style="color:#00009f">int</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> HybridCLR</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RuntimeApi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">LoadMetadataForAOTAssembly</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dllBytes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> HomologousImageMode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SuperSet</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               Debug</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token interpolation-string string" style="color:#e3116c">$&quot;LoadMetadataForAOTAssembly:</span><span class="token interpolation-string interpolation punctuation" style="color:#393A34">{</span><span class="token interpolation-string interpolation expression language-csharp">aotDllName</span><span class="token interpolation-string interpolation punctuation" style="color:#393A34">}</span><span class="token interpolation-string string" style="color:#e3116c">.ret:</span><span class="token interpolation-string interpolation punctuation" style="color:#393A34">{</span><span class="token interpolation-string interpolation expression language-csharp">err</span><span class="token interpolation-string interpolation punctuation" style="color:#393A34">}</span><span class="token interpolation-string string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="aot-generic-problems-caused-by-some-c-special-mechanisms">AOT generic problems caused by some C# special mechanisms<a href="#aot-generic-problems-caused-by-some-c-special-mechanisms" class="hash-link" aria-label="Direct link to AOT generic problems caused by some C# special mechanisms" title="Direct link to AOT generic problems caused by some C# special mechanisms">​</a></h2><p>The compiler may generate implicit AOT generic references for complex syntactic sugar such as async. Therefore, in order for these mechanisms to work properly, the AOT generic instantiation problems caused by them must also be resolved.</p><p>Taking async as an example, the compiler generates several classes, state machines and some codes for async. These hidden generated codes contain calls to multiple AOT generic functions. The common ones are:</p><ul><li><code>void AsyncTaskMethodBuilder::Start&lt;TStateMachine&gt;(ref TStateMachine stateMachine)</code></li><li><code>void AsyncTaskMethodBuilder::AwaitUnsafeOnCompleted&lt;TAwaiter, TStateMachine&gt;(ref TAwaiter awaiter, ref TStateMachine stateMachine)</code></li><li><code>void AsyncTaskMethodBuilder::SetException(Exception exception)</code></li><li><code>void AsyncTaskMethodBuilder::SetResult()</code></li><li><code>void AsyncTaskMethodBuilder&lt;T&gt;::Start&lt;TStateMachine&gt;(ref TStateMachine stateMachine)</code></li><li><code>void AsyncTaskMethodBuilder&lt;T&gt;::AwaitUnsafeOnCompleted&lt;TAwaiter, TStateMachine&gt;(ref TAwaiter awaiter, ref TStateMachine stateMachine)</code></li><li><code>void AsyncTaskMethodBuilder&lt;T&gt;::SetException(Exception exception)</code></li><li><code>void AsyncTaskMethodBuilder&lt;T&gt;::SetResult(T result)</code></li></ul><p>Both generic instantiation techniques can solve these problems. You can use the generic sharing mechanism, that is, instantiate these functions in advance in AOT, but <strong>Note</strong>, the state machine generated by Unity in the dll compiled in release mode is of the ValueType type, which makes it impossible to sharing generics, but The state machine generated in debug mode is of class type and can be shared generically. Therefore, if you use the il2cpp generic sharing mechanism, in order to use the async syntax in the hot update, when using the script to compile the dll, you must add <code>scriptCompilationSettings.options = ScriptCompilationOptions.DevelopmentBuild;</code> code, so that the compiled state machine is a class type, Works fine in hot update code. If <code>Supplementary Metadata Technology</code> has been used, due to full support for AOT generics, there are <strong>unlimited</strong> compilation methods.</p><p>Instantiating these generics in AOT is tedious and <strong>strongly recommended</strong> to use the supplementary metadata mechanism.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="full-generic-sharing-technical-supplementary-introduction"><code>full generic sharing</code> technical supplementary introduction<a href="#full-generic-sharing-technical-supplementary-introduction" class="hash-link" aria-label="Direct link to full-generic-sharing-technical-supplementary-introduction" title="Direct link to full-generic-sharing-technical-supplementary-introduction">​</a></h2><p>Since the 2021.3.x LTS version, il2cpp has fully supported the <code>full generic sharing&#x27; technology. When the </code>Il2Cpp Code Generation<code>option in Build Settings is</code>faster runtime<code>, it is the generic sharing mechanism introduced in the previous chapter , enabled for </code>faster(smaller) build<code></code>full generic sharing<code>mechanism. The</code>full generic sharing` technology can overcome the defect that the value type generics of traditional il2cpp cannot be shared. All generic instances of generic functions (regardless of whether the generic parameters are value types or class types) completely sharing one code.</p><p>The advantage of full generic sharing is that it can be instantiated arbitrarily, and it can save code size. The disadvantage is that it greatly hurts the performance of generic functions. The fully generic shared code is sometimes several to ten times slower than the standard generic shared code, and even worse than the purely interpreted version. Therefore it is strongly recommended to <strong>not enable</strong> the <code>faster(smaller) build</code> option. Because of this, although HybridCLR can work with the <code>full generic sharing</code> mechanism, it does not take advantage of this mechanism at all. Because this mechanism has basically no practical significance except when you want to reduce the inclusion extremely.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="appendix-example-of-shared-generic-instantiation-of-aot-generics">Appendix: Example of shared generic instantiation of AOT generics<a href="#appendix-example-of-shared-generic-instantiation-of-aot-generics" class="hash-link" aria-label="Direct link to Appendix: Example of shared generic instantiation of AOT generics" title="Direct link to Appendix: Example of shared generic instantiation of AOT generics">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-1">Example 1<a href="#example-1" class="hash-link" aria-label="Direct link to Example 1" title="Direct link to Example 1">​</a></h3><p>error log</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MissingMethodException</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AOT generic method isn&#x27;</span><span class="token class-name">t</span><span class="token plain"> instantiated </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> aot module</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token return-type class-name keyword" style="color:#00009f">void</span><span class="token plain"> System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Collections</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Generic</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">List</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">String</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ctor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You add a call to <code>List&lt;string&gt;.ctor()</code> in RefType, which is <code>new List&lt;string&gt;()</code>. Thanks to the <strong>generic sharing mechanism</strong>, you just call <code>new List&lt;object&gt;()</code>.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">RefTypes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">MyAOTRefs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">List</span><span class="token constructor-invocation class-name punctuation" style="color:#393A34">&lt;</span><span class="token constructor-invocation class-name keyword" style="color:#00009f">object</span><span class="token constructor-invocation class-name punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// can also use new List&lt;string&gt;()</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-2">Example 2<a href="#example-2" class="hash-link" aria-label="Direct link to Example 2" title="Direct link to Example 2">​</a></h3><p>error log</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MissingMethodException</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AOT generic method isn&#x27;</span><span class="token class-name">t</span><span class="token plain"> instantiated </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> aot module</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token return-type class-name keyword" style="color:#00009f">void</span><span class="token plain"> System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ValueType</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Int32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">String</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ctor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>The empty constructor of the value type does not call the corresponding constructor, but corresponds to the initobj instruction. In fact, you can&#x27;t directly reference it, but you just need to force the instantiation of this type, and all functions of the preserve class will naturally include the .ctor function.</p></div></div><p>In practice you can use forced boxing <code>(object)(default(ValueTuple&lt;int, object&gt;))</code>.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">RefTypes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">MyAOTRefs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">// The following two ways of writing are both possible</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       _ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">object</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">ValueTuple</span><span class="token constructor-invocation class-name punctuation" style="color:#393A34">&lt;</span><span class="token constructor-invocation class-name keyword" style="color:#00009f">int</span><span class="token constructor-invocation class-name punctuation" style="color:#393A34">,</span><span class="token constructor-invocation class-name"> </span><span class="token constructor-invocation class-name keyword" style="color:#00009f">object</span><span class="token constructor-invocation class-name punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       _ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">object</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">(</span><span class="token type-expression class-name">ValueTuple</span><span class="token type-expression class-name punctuation" style="color:#393A34">&lt;</span><span class="token type-expression class-name keyword" style="color:#00009f">int</span><span class="token type-expression class-name punctuation" style="color:#393A34">,</span><span class="token type-expression class-name"> </span><span class="token type-expression class-name keyword" style="color:#00009f">object</span><span class="token type-expression class-name punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-3">Example 3<a href="#example-3" class="hash-link" aria-label="Direct link to Example 3" title="Direct link to Example 3">​</a></h3><p>error log</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MissingMethodException</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AOT generic method isn&#x27;</span><span class="token class-name">t</span><span class="token plain"> instantiated </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> aot module</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Void System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Runtime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CompilerService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AsyncVoidMethodBuilder</span><span class="token punctuation" style="color:#393A34">::</span><span class="token plain">Start</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">UIMgr</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">ShowUId__2</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">UIMgr</span><span class="token operator" style="color:#393A34">+</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">ShowUI</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">d__2</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">RefTypes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">MyAOTRefs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token class-name">System</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Runtime</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">CompilerService</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">AsyncVoidMethodBuilder</span><span class="token plain"> builder </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token class-name">IAsyncStateMachine</span><span class="token plain"> asm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">ref</span><span class="token plain"> asm</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/docs/basic/monobehaviour"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Use MonoBehaviour</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/docs/basic/methodbridge"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">AOT-interpreter bridge function</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#generic-sharing-mechanism-of-il2cpp" class="table-of-contents__link toc-highlight">Generic sharing mechanism of il2cpp</a></li><li><a href="#shared-type-calculation-rules" class="table-of-contents__link toc-highlight">Shared type calculation rules</a><ul><li><a href="#non-enumeration-value-types" class="table-of-contents__link toc-highlight">Non-enumeration value types</a></li><li><a href="#enum-type" class="table-of-contents__link toc-highlight">Enum Type</a></li><li><a href="#class-reference-type" class="table-of-contents__link toc-highlight">class reference type</a></li><li><a href="#generic-types" class="table-of-contents__link toc-highlight">Generic Types</a></li><li><a href="#shared-generic-function-evaluation-rules-for-generic-functions" class="table-of-contents__link toc-highlight">Shared generic function evaluation rules for generic functions</a></li></ul></li><li><a href="#the-reason-why-the-value-type-in-il2cpp-does-not-support-generic-sharing" class="table-of-contents__link toc-highlight">The reason why the value type in il2cpp does not support generic sharing</a><ul><li><a href="#problems-caused-by-memory-alignment" class="table-of-contents__link toc-highlight">Problems caused by memory alignment</a></li><li><a href="#abi-issues" class="table-of-contents__link toc-highlight">ABI issues</a></li></ul></li><li><a href="#defects-of-the-generic-sharing-mechanism" class="table-of-contents__link toc-highlight">Defects of the generic sharing mechanism</a></li><li><a href="#generic-function-instantiation-technology-based-on-supplementary-metadata-hybridclrs-patented-technology" class="table-of-contents__link toc-highlight">Generic function instantiation technology based on supplementary metadata (HybridCLR&#39;s patented technology)</a><ul><li><a href="#get-supplementary-metadata-dll" class="table-of-contents__link toc-highlight">Get Supplementary Metadata dll</a></li><li><a href="#should-make-up" class="table-of-contents__link toc-highlight">should make up</a></li><li><a href="#metadata-mode-homologousimagemode" class="table-of-contents__link toc-highlight">Metadata Mode HomologousImageMode</a></li><li><a href="#load-supplementary-metadata-sample-code" class="table-of-contents__link toc-highlight">Load supplementary metadata sample code</a></li></ul></li><li><a href="#aot-generic-problems-caused-by-some-c-special-mechanisms" class="table-of-contents__link toc-highlight">AOT generic problems caused by some C# special mechanisms</a></li><li><a href="#full-generic-sharing-technical-supplementary-introduction" class="table-of-contents__link toc-highlight"><code>full generic sharing</code> technical supplementary introduction</a></li><li><a href="#appendix-example-of-shared-generic-instantiation-of-aot-generics" class="table-of-contents__link toc-highlight">Appendix: Example of shared generic instantiation of AOT generics</a><ul><li><a href="#example-1" class="table-of-contents__link toc-highlight">Example 1</a></li><li><a href="#example-2" class="table-of-contents__link toc-highlight">Example 2</a></li><li><a href="#example-3" class="table-of-contents__link toc-highlight">Example 3</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Repository</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/focus-creative-games/hybridclr" target="_blank" rel="noopener noreferrer" class="footer__link-item">hybridclr<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/focus-creative-games/il2cpp_plus" target="_blank" rel="noopener noreferrer" class="footer__link-item">il2cpp_plus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/focus-creative-games/hybridclr_unity" target="_blank" rel="noopener noreferrer" class="footer__link-item">hybridclr package<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/focus-creative-games/hybridclr" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gitee.com/focus-creative-games/hybridclr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 <a href="https://code-philosophy.com/">Code Philosophy</a>. All Rights Reserved.</div></div></div></footer></div>
<script src="/en/assets/js/runtime~main.ac8000ae.js"></script>
<script src="/en/assets/js/main.c0ac5868.js"></script>
</body>
</html>